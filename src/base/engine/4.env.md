---
lang: zh-CN
sidebarDepth: 2
meta:
  - name: description
    content: 个人总结的openlayers学习技术文档-语法
  - name: keywords
    content: vuepress,最新技术文档,vuepress语法,markdown语法
---

# 四.Layer(类别)

::: tip 前言
Layer 按照类别，由一个基类加一个或多个子图层类叠加而成

- 瓦片数据 Tile/TileLayer
- 矢量数据 Vector/VectorLayer
- 矢量切片 Vector/VectorTile
- 图片数据 Image/ImageLayer

:::
source 是 Layer 的重要组成部分，表示图层的来源，也就是服务地址

## 1.瓦片图

OpenLayers 支持从 OSM、Bing、MapBox、Stamen 和其他任何 XYZ 瓦片资源中提取地图瓦片并在前端展示，同时也支持 OGC 的 WMTS 规范的瓦片服务以及 ArcGIS 规范的瓦片服务

### 1.1 OSM 瓦片图

ol.source.OSM，OpenStreetMap 提供的切片数据，继承自 ol.source.XYZ

:::demo

```vue {17}
<template>
  <div ref="map" class="map"></div>
</template>
<script>
export default {
  mounted() {
    let {
      Map,
      View,
      layer: { WebGLTile: TileLayer },
      source: { OSM },
    } = ol
    new Map({
      target: this.$refs.map,
      layers: [
        new TileLayer({
          source: new OSM(),
        }),
      ],
      view: new View({
        center: [12579156, 3274244],
        zoom: 12,
      }),
    })
  },
}
</script>
```

:::

### 1.2 Bing 瓦片图

ol.source.BingMaps ，必应地图的切片数据，继承自 ol.source.TileImage

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
  <select ref="layerselect">
    <option value="Aerial">Aerial</option>
    <option value="AerialWithLabelsOnDemand" selected>
      Aerial with labels
    </option>
    <option value="RoadOnDemand">Road</option>
    <option value="CanvasDark">Road dark</option>
    <option value="OrdnanceSurvey">Ordnance Survey</option>
  </select>
</template>

<script>
export default {
  mounted() {
    let {
      Map,
      View,
      layer: { Tile: TileLayer },
      source: { BingMaps },
    } = ol
    const styles = [
      "RoadOnDemand",
      "Aerial",
      "AerialWithLabelsOnDemand",
      "CanvasDark",
      "OrdnanceSurvey",
    ]
    const layers = []
    let i, ii
    for (i = 0, ii = styles.length; i < ii; ++i) {
      layers.push(
        new TileLayer({
          visible: false,
          preload: Infinity,
          source: new BingMaps({
            key: mapkeys.BingMaps,
            imagerySet: styles[i],
          }),
        })
      )
    }
    const map = new Map({
      layers: layers,
      target: this.$refs.map,
      view: new View({
        center: [-6655.5402445057125, 6709968.258934638],
        zoom: 13,
      }),
    })
    const select = this.$refs.layerselect
    function onChange() {
      const style = select.value
      for (let i = 0, ii = layers.length; i < ii; ++i) {
        layers[i].setVisible(styles[i] === style)
      }
    }
    select.addEventListener("change", onChange)
    onChange()
  },
}
</script>
```

:::

### 1.3 Stamen 瓦片图

ol.source.Stamen，Stamen 提供的地图切片数据，继承自 ol.source.XYZ

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      Map,
      View,
      layer: { Tile: TileLayer },
      source: { Stamen },
      proj: { fromLonLat },
    } = ol
    const map = new Map({
      layers: [
        new TileLayer({
          source: new Stamen({
            layer: "watercolor",
          }),
        }),
        new TileLayer({
          source: new Stamen({
            layer: "terrain-labels",
          }),
        }),
      ],
      target: this.$refs.map,
      view: new View({
        center: fromLonLat([114.31, 30.52]),
        zoom: 12,
      }),
    })
  },
}
</script>
```

:::

### 1.4 XYZ 瓦片图

ol.source.XYZ，XYZ 格式的切片数据，继承自 ol.source.TileImage

侦听地图 loadstart 和 loadend 事件以在地图顶部显示加载微调器

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      Map,
      View,
      layer: { Tile: TileLayer },
      source: { XYZ },
      proj: { fromLonLat },
    } = ol
    const key = "get_your_own_D6rA4zTHduk6KOKTXzGB"
    const attributions =
      '<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> ' +
      '<a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>'
    const map = new Map({
      layers: [
        new TileLayer({
          source: new XYZ({
            attributions: attributions,
            url:
              "https://api.maptiler.com/maps/streets/{z}/{x}/{y}.png?key=" +
              key,
            tileSize: 512,
          }),
        }),
      ],
      target: this.$refs.map,
      view: new View({
        center: fromLonLat([114.31, 30.52]),
        zoom: 12,
      }),
    })
    map.on("loadstart", function () {
      map.getTargetElement().classList.add("spinner")
    })
    map.on("loadend", function () {
      map.getTargetElement().classList.remove("spinner")
    })
  },
}
</script>
```

:::

### 1.5.WMTS 瓦片图

ol.source.WMTS，WMTS 服务提供的切片数据。继承自 ol.source.TileImage

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>
<script>
export default {
  mounted() {
    let {
      Map,
      View,
      tilegrid: { WMTS: WMTSTileGrid },
      layer: { Tile: TileLayer },
      source: { WMTS },
      proj: { fromLonLat, get: getProjection },
      extent: { getWidth },
    } = ol
    const map = new Map({
      target: this.$refs.map,
      view: new View({
        zoom: 5,
        center: fromLonLat([5, 45]),
      }),
    })
    const resolutions = []
    const matrixIds = []
    const proj3857 = getProjection("EPSG:3857")
    const maxResolution = getWidth(proj3857.getExtent()) / 256
    for (let i = 0; i < 20; i++) {
      matrixIds[i] = i.toString()
      resolutions[i] = maxResolution / Math.pow(2, i)
    }
    const tileGrid = new WMTSTileGrid({
      origin: [-20037508, 20037508],
      resolutions: resolutions,
      matrixIds: matrixIds,
    })
    const ign_source = new WMTS({
      url: "https://wxs.ign.fr/choisirgeoportail/geoportail/wmts",
      layer: "GEOGRAPHICALGRIDSYSTEMS.PLANIGNV2",
      matrixSet: "PM",
      format: "image/png",
      projection: "EPSG:3857",
      tileGrid: tileGrid,
      style: "normal",
      attributions:
        '<a href="https://www.ign.fr/" target="_blank">' +
        '<img src="https://wxs.ign.fr/static/logos/IGN/IGN.gif" title="Institut national de l\'' +
        'information géographique et forestière" alt="IGN"></a>',
    })
    const ign = new TileLayer({
      source: ign_source,
    })
    map.addLayer(ign)
  },
}
</script>
```

:::

### 1.6 WMS

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      Map,
      View,
      layer: { Tile: TileLayer },
      source: { OSM, TileWMS },
    } = ol

    const layers = [
      new TileLayer({
        source: new OSM(),
      }),
      new TileLayer({
        extent: [-13884991, 2870341, -7455066, 6338219],
        source: new TileWMS({
          url: "https://ahocevar.com/geoserver/wms",
          params: { LAYERS: "topp:states", TILED: true },
          serverType: "geoserver",
          transition: 0,
        }),
      }),
    ]
    const map = new Map({
      layers: layers,
      target: this.$refs.map,
      view: new View({
        center: [-10997148, 4569099],
        zoom: 4,
      }),
    })
  },
}
</script>
```

:::

### 1.7 TileJSON

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      Map,
      View,
      layer: { Tile: TileLayer },
      source: { TileJSON },
    } = ol
    const map = new Map({
      layers: [
        new TileLayer({
          source: new TileJSON({
            url: "https://a.tiles.mapbox.com/v3/aj.1x1-degrees.json?secure=1",
            crossOrigin: "anonymous",
          }),
        }),
      ],
      target: this.$refs.map,
      view: new View({
        center: [12579156, 3274244],
        zoom: 2,
      }),
    })
  },
}
</script>
```

:::

### 1.8 TileDebug

ol.source.TileDebug，并不从服务器获取数据，而是为切片渲染一个网格，继承自 ol.source.Tile

黑色网格瓦片图是使用 HTML5 画布在客户端上生成的。显示的 TMS 瓦片图坐标使用 TMS 的自定义模板、矢量瓦片图源的 512 像素瓦片图网格和矢量瓦片图的 zDirection 设置生成。注意如何在瓦片图之间分割国家多边形，矢量标签可能会出现在每个瓦片图中。
:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      format: { MVT },
      Map,
      View,
      layer: { Tile: TileLayer, VectorTile: VectorTileLayer },
      source: { VectorTile: VectorTileSource, TileDebug },
      style: { Fill, Stroke, Style, Text },
    } = ol
    const style = new Style({
      fill: new Fill({
        color: "rgba(255, 255, 255, 0.6)",
      }),
      stroke: new Stroke({
        color: "#319FD3",
        width: 1,
      }),
      text: new Text({
        font: "12px Calibri,sans-serif",
        fill: new Fill({
          color: "#000",
        }),
        stroke: new Stroke({
          color: "#fff",
          width: 3,
        }),
      }),
    })

    const vtLayer = new VectorTileLayer({
      declutter: true,
      source: new VectorTileSource({
        maxZoom: 15,
        format: new MVT(),
        url:
          "https://ahocevar.com/geoserver/gwc/service/tms/1.0.0/" +
          "ne:ne_10m_admin_0_countries@EPSG%3A900913@pbf/{z}/{x}/{-y}.pbf",
      }),
      style: function (feature) {
        style.getText().setText(feature.get("name"))
        return style
      },
    })

    const debugLayer = new TileLayer({
      source: new TileDebug({
        template: "z:{z} x:{x} y:{-y}",
        projection: vtLayer.getSource().getProjection(),
        tileGrid: vtLayer.getSource().getTileGrid(),
        zDirection: 1,
      }),
    })

    const map = new Map({
      layers: [vtLayer, debugLayer],
      target: this.$refs.map,
      view: new View({
        center: [0, 6000000],
        zoom: 4,
      }),
    })
  },
}
</script>
```

:::

### 1.9 TileJSON

ol.source.TileJSON，TileJSON 格式的切片数据，继承自 ol.source.TileImage

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      Map,
      View,
      layer: { Tile: TileLayer },
      source: { TileJSON, OSM },
      proj: { fromLonLat },
    } = ol
    const map = new Map({
      layers: [
        new TileLayer({
          className: "bw",
          source: new OSM(),
        }),
        new TileLayer({
          source: new TileJSON({
            url:
              "https://api.tiles.mapbox.com/v4/mapbox.va-quake-aug.json?secure&access_token=" +
              mapkeys.mapbox,
            crossOrigin: "anonymous",
            transition: 0,
          }),
        }),
      ],
      target: this.$refs.map,
      view: new View({
        center: fromLonLat([-77.93255, 37.9555]),
        zoom: 7,
      }),
    })
  },
}
</script>
```

:::

### 2.0 Zoomify

ol.source.Zoomify，Zoomify 格式的切片数据，继承自 ol.source.TileImage

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
  <div class="controls">
    <select ref="zoomifyProtocol">
      <option value="zoomify">Zoomify</option>
      <option value="zoomifyretina">Zoomify Retina</option>
    </select>
  </div>
</template>

<script>
export default {
  mounted() {
    let {
      Map,
      View,
      layer: { Tile: TileLayer },
      source: { Zoomify },
    } = ol
    const imgWidth = 4000
    const imgHeight = 3000
    const zoomifyUrl = "https://ol-zoomify.surge.sh/zoomify/"
    const source = new Zoomify({
      url: zoomifyUrl,
      size: [imgWidth, imgHeight],
      crossOrigin: "anonymous",
      zDirection: -1,
    })
    const extent = source.getTileGrid().getExtent()
    const retinaPixelRatio = 2
    const retinaSource = new Zoomify({
      url: zoomifyUrl,
      size: [imgWidth, imgHeight],
      crossOrigin: "anonymous",
      zDirection: -1,
      tilePixelRatio: retinaPixelRatio,
      tileSize: 256 / retinaPixelRatio,
    })
    const layer = new TileLayer({
      source: source,
    })
    const map = new Map({
      layers: [layer],
      target: this.$refs.map,
      view: new View({
        resolutions: layer.getSource().getTileGrid().getResolutions(),
        extent: extent,
        constrainOnlyCenter: true,
      }),
    })
    map.getView().fit(extent)
    this.$refs.zoomifyProtocol.addEventListener("change", function (event) {
      const value = event.currentTarget.value
      if (value === "zoomify") {
        layer.setSource(source)
      } else if (value === "zoomifyretina") {
        layer.setSource(retinaSource)
      }
    })
  },
}
</script>
```

:::

## 2.矢量图

矢量数据使用矢量数据模型来组织地理信息，矢量数据模型采用离散对象来表示地球表面的空间要素，因此，简单来说，矢量数据包含了各个地理要素的空间坐标与属性信息，这使我们能对地理信息进行细粒度的使用与操作

::: tip 总结
瓦片地图将地理信息以一块块瓦片的形式进行组织并渲染，瓦片的本质是图片，因此不能对瓦片地图进行修改样式、空间分析等操作，而且瓦片不包含属性信息，隐含的空间信息也不能直接获取使用
:::

## 3.矢量瓦片图

### 3.1 Mapbox 矢量瓦片图

- VectorTileLayer

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      format: { MVT },
      Map,
      View,
      layer: { VectorTile: VectorTileLayer },
      source: { VectorTile: VectorTileSource },
      style: { Fill, Icon, Stroke, Style, Text },
      proj: { fromLonLat },
    } = ol

    const map = new Map({
      layers: [
        new VectorTileLayer({
          declutter: true,
          source: new VectorTileSource({
            attributions:
              '© <a href="https://www.mapbox.com/map-feedback/">Mapbox</a> ' +
              '© <a href="https://www.openstreetmap.org/copyright">' +
              "OpenStreetMap contributors</a>",
            format: new MVT(),
            url:
              "https://{a-d}.tiles.mapbox.com/v4/mapbox.mapbox-streets-v6/" +
              "{z}/{x}/{y}.vector.pbf?access_token=" +
              mapkeys.mapbox,
          }),
          style: createMapboxStreetsV6Style(Style, Fill, Stroke, Icon, Text),
        }),
      ],
      target: this.$refs.map,
      view: new View({
        center: [12579156, 3274244],
        zoom: 12,
      }),
    })
  },
}
</script>
```

:::

## 4.图片图

ImageLayer 类 + source

### 4.1 ImageStatic

ol.source.ImageStatic，提供单一的静态图片地图，继承自 ol.source.Image

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>
<script>
export default {
  mounted() {
    let {
      Map,
      View,
      layer: { Image: ImageLayer },
      source: { ImageStatic: Static },
      extent: { getCenter },
      proj: { Projection },
    } = ol
    const extent = [0, 0, 1024, 968]
    const projection = new Projection({
      code: "xkcd-image",
      units: "pixels",
      extent: extent,
    })
    const map = new Map({
      layers: [
        new ImageLayer({
          source: new Static({
            attributions: '© <a href="https://xkcd.com/license.html">xkcd</a>',
            url: "https://imgs.xkcd.com/comics/online_communities.png",
            projection: projection,
            imageExtent: extent,
          }),
        }),
      ],
      target: this.$refs.map,
      view: new View({
        projection: projection,
        center: getCenter(extent),
        zoom: 2,
        maxZoom: 8,
      }),
    })
  },
}
</script>
```

:::

### 4.2 ImageArcGISRest

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      Map,
      View,
      layer: { Tile: TileLayer, Image: ImageLayer },
      source: { OSM, ImageArcGISRest },
    } = ol
    const url =
      "https://sampleserver1.arcgisonline.com/ArcGIS/rest/services/" +
      "Specialty/ESRI_StateCityHighway_USA/MapServer"
    const layers = [
      new TileLayer({
        source: new OSM(),
      }),
      new ImageLayer({
        source: new ImageArcGISRest({
          ratio: 1,
          params: {},
          url: url,
        }),
      }),
    ]
    const map = new Map({
      layers: layers,
      target: this.$refs.map,
      view: new View({
        center: [-10997148, 4569099],
        zoom: 4,
      }),
    })
  },
}
</script>
```

:::

### 4.3 ImageWMS

ol.source.ImageWMS，WMS 服务提供的单一的图片数据，继承自 ol.source.Image，触发 ol.source.ImageEvent

:::demo

```vue
<template>
  <div class="wrapper">
    <div ref="map" class="map"></div>
    <div ref="progress"></div>
  </div>
</template>

<script>
export default {
  mounted() {
    let {
      Map,
      View,
      layer: { Image: ImageLayer },
      source: { ImageWMS },
    } = ol
    function Progress(el) {
      this.el = el
      this.loading = 0
      this.loaded = 0
    }
    Progress.prototype.addLoading = function () {
      ++this.loading
      this.update()
    }
    Progress.prototype.addLoaded = function () {
      ++this.loaded
      this.update()
    }
    Progress.prototype.update = function () {
      const width = ((this.loaded / this.loading) * 100).toFixed(1) + "%"
      this.el.style.width = width
    }
    Progress.prototype.show = function () {
      this.el.style.visibility = "visible"
    }
    Progress.prototype.hide = function () {
      const style = this.el.style
      setTimeout(function () {
        style.visibility = "hidden"
        style.width = 0
      }, 250)
    }
    const progress = new Progress(this.$refs.progress)
    const source = new ImageWMS({
      url: "https://ahocevar.com/geoserver/wms",
      params: { LAYERS: "topp:states" },
      serverType: "geoserver",
    })
    source.on("imageloadstart", function () {
      progress.addLoading()
    })
    source.on(["imageloadend", "imageloaderror"], function () {
      progress.addLoaded()
    })
    const map = new Map({
      layers: [new ImageLayer({ source: source })],
      target: this.$refs.map,
      view: new View({
        center: [-10997148, 4569099],
        zoom: 4,
      }),
    })
    map.on("loadstart", function () {
      progress.show()
    })
    map.on("loadend", function () {
      progress.hide()
    })
  },
}
</script>
```

:::

### 4.4 ImageMapGuide

ol.source.ImageMapGuide，Mapguide 服务器提供的图片地图数据，继承自 ol.source.Image，fire ol.source.ImageEvent

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      Map,
      View,
      layer: { Image: ImageLayer },
      source: { ImageMapGuide },
    } = ol

    const mdf = "Library://Samples/Sheboygan/Maps/Sheboygan.MapDefinition"
    const agentUrl = "https://mikenunn.net/mapguide/mapagent/mapagent.fcgi?"
    const bounds = [
      -87.865114442365922, 43.665065564837931, -87.595394059497067,
      43.823852564430069,
    ]
    const map = new Map({
      layers: [
        new ImageLayer({
          extent: bounds,
          source: new ImageMapGuide({
            projection: "EPSG:4326",
            url: agentUrl,
            useOverlay: false,
            metersPerUnit: 111319.4908, //value returned from mapguide
            params: {
              MAPDEFINITION: mdf,
              FORMAT: "PNG",
              VERSION: "3.0.0",
              USERNAME: "OLGuest",
              PASSWORD: "olguest",
            },
            ratio: 2,
          }),
        }),
      ],
      target: this.$refs.map,
      view: new View({
        center: [-87.7302542509315, 43.744459064634],
        projection: "EPSG:4326",
        zoom: 12,
      }),
    })
  },
}
</script>
```

:::

## 5.其他

- ol.source.Cluster，聚簇矢量数据，继承自 ol.source.Vector
- ol.source.ImageCanvas，数据来源是一个 canvas 元素，其中的数据是图片，继承自 ol.source.Image
- ol.source.ImageVector，数据来源是一个 canvas 元素，但是其中的数据是矢量来源 ol.source.Vector，继承自 ol.source.ImageCanvas
- ol.source.MapQuest，MapQuest 提供的切片数据，继承自 ol.source.XYZ
- ol.source.TileVector，被切分为网格的矢量数据，继承自 ol.source.Vector
- ol.source.TileImage，提供切分成切片的图片数据，继承自 ol.source.Tile，触发 ol.source.TileEvent
- ol.source.TileUTFGrid，TileJSON 格式 的 UTFGrid 交互数据，继承自 ol.source.Tile
- ol.source.TileArcGISRest，ArcGIS Rest 服务提供的切片数据，继承自 ol.source.TileImage
