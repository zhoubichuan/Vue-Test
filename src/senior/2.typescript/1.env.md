---
lang: zh-CN
sidebarDepth: 2
meta:
  - name: description
    content: 个人总结的openlayers学习技术文档-语法
  - name: keywords
    content: vuepress,最新技术文档,vuepress语法,markdown语法
---

# 一.点相关

## 1.图标比例尺

:::demo

```vue
<template>
  <div ref="map" class="map"><div id="popup"></div></div>
</template>

<script>
export default {
  mounted() {
    let {
      Feature,
      Overlay,
      geom: { Point },
      Map,
      View,
      layer: { Tile: TileLayer, Vector: VectorLayer },
      source: { TileJSON, Vector: VectorSource },
      style: { Icon, Style, Text },
      proj: { fromLonLat },
      render: { getVectorContext },
    } = ol
    const rasterLayer = new TileLayer({
      source: new TileJSON({
        url: "https://a.tiles.mapbox.com/v3/aj.1x1-degrees.json?secure=1",
        crossOrigin: "",
      }),
    })
    const iconFeature = new Feature({
      geometry: new Point(fromLonLat([0, -10])),
      name: "Fish.1",
    })
    const feature1 = new Feature({
      geometry: new Point(fromLonLat([0, -10])),
      name: "Fish.1 Island",
    })
    const feature2 = new Feature({
      geometry: new Point(fromLonLat([-30, 10])),
      name: "Fish.2 Island",
    })
    const iconStyle = new Style({
      image: new Icon({
        anchor: [0.5, 0.9],
        src: this.$withBase("/data/fish.png"),
        crossOrigin: "",
        scale: [0, 0],
        rotation: Math.PI / 4,
      }),
      text: new Text({
        text: "FISH\nTEXT",
        scale: [0, 0],
        rotation: Math.PI / 4,
        textAlign: "center",
        textBaseline: "top",
      }),
    })
    let i = 0
    let j = 45
    iconFeature.setStyle(function () {
      const x = Math.sin((i * Math.PI) / 180) * 3
      const y = Math.sin((j * Math.PI) / 180) * 4
      iconStyle.getImage().setScale([x, y])
      iconStyle.getText().setScale([x, y])
      return iconStyle
    })
    rasterLayer.on("postrender", function (event) {
      const vectorContext = getVectorContext(event)
      const x = Math.cos((i * Math.PI) / 180) * 3
      const y = Math.cos((j * Math.PI) / 180) * 4
      iconStyle.getImage().setScale([x, y])
      iconStyle.getText().setScale([x, y])
      vectorContext.drawFeature(feature2, iconStyle)
    })
    const vectorSource = new VectorSource({
      features: [iconFeature, feature1, feature2],
    })
    const vectorLayer = new VectorLayer({
      source: vectorSource,
    })
    const map = new Map({
      layers: [rasterLayer, vectorLayer],
      target: this.$refs.map,
      view: new View({
        center: fromLonLat([-15, 0]),
        zoom: 3,
      }),
    })
    setInterval(function () {
      i = (i + 4) % 360
      j = (j + 5) % 360
      vectorSource.changed()
    }, 1000)
    const element = document.getElementById("popup")
    const popup = new Overlay({
      element: element,
      positioning: "bottom-center",
      stopEvent: false,
    })
    map.addOverlay(popup)
    map.on("click", function (evt) {
      const feature = map.forEachFeatureAtPixel(evt.pixel, function (feature) {
        return feature
      })
      $(element).popover("dispose")
      if (feature) {
        popup.setPosition(evt.coordinate)
        $(element).popover({
          placement: "top",
          html: true,
          animation: false,
          content: feature.get("name"),
        })
        $(element).popover("show")
      }
    })
    map.on("pointermove", function (e) {
      const pixel = map.getEventPixel(e.originalEvent)
      const hit = map.hasFeatureAtPixel(pixel)
      map.getTarget().style.cursor = hit ? "pointer" : ""
    })
    map.on("movestart", function () {
      $(element).popover("dispose")
    })
  },
}
</script>
```

:::

## 2.图标精灵与 WebGL

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
  <div>Current sighting: <span id="info"></span></div>
  <div>
    <label for="shape-filter">Filter by UFO shape:</label>
    <select id="shape-filter"></select>
  </div>
</template>

<script>
export default {
  mounted() {
    let {
      Feature,
      geom: { Point },
      Map,
      View,
      layer: { Tile: TileLayer, WebGLPoints: WebGLPointsLayer },
      source: { XYZ, Vector },
      proj: { fromLonLat },
    } = ol
    const attributions =
      '<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> ' +
      '<a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>'
    const map = new Map({
      layers: [
        new TileLayer({
          source: new XYZ({
            attributions: attributions,
            url:
              "https://api.maptiler.com/tiles/satellite/{z}/{x}/{y}.jpg?key=" +
              mapkeys.maptiler,
            tileSize: 512,
          }),
        }),
      ],
      target: this.$refs.map,
      view: new View({
        center: [0, 4000000],
        zoom: 2,
      }),
    })
    const vectorSource = new Vector({
      features: [],
      attributions: "National UFO Reporting Center",
    })
    const oldColor = [255, 160, 110]
    const newColor = [180, 255, 200]
    const size = 16
    const style = {
      variables: {
        filterShape: "all",
      },
      filter: [
        "case",
        ["!=", ["var", "filterShape"], "all"],
        ["==", ["get", "shape"], ["var", "filterShape"]],
        true,
      ],
      symbol: {
        symbolType: "image",
        src: this.$withBase("/data/ufo_shapes.png"),
        size: size,
        color: [
          "interpolate",
          ["linear"],
          ["get", "year"],
          1950,
          oldColor,
          2013,
          newColor,
        ],
        rotateWithView: false,
        offset: [0, 0],
        textureCoord: [
          "match",
          ["get", "shape"],
          "light",
          [0, 0, 0.25, 0.5],
          "sphere",
          [0.25, 0, 0.5, 0.5],
          "circle",
          [0.25, 0, 0.5, 0.5],
          "disc",
          [0.5, 0, 0.75, 0.5],
          "oval",
          [0.5, 0, 0.75, 0.5],
          "triangle",
          [0.75, 0, 1, 0.5],
          "fireball",
          [0, 0.5, 0.25, 1],
          [0.75, 0.5, 1, 1],
        ],
      },
    }
    const shapeTypes = {
      all: 0,
    }
    const shapeSelect = document.getElementById("shape-filter")
    shapeSelect.addEventListener("input", function () {
      style.variables.filterShape =
        shapeSelect.options[shapeSelect.selectedIndex].value
      map.render()
    })
    function fillShapeSelect() {
      Object.keys(shapeTypes)
        .sort(function (a, b) {
          return shapeTypes[b] - shapeTypes[a]
        })
        .forEach(function (shape) {
          const option = document.createElement("option")
          option.text = `${shape} (${shapeTypes[shape]} sightings)`
          option.value = shape
          shapeSelect.appendChild(option)
        })
    }
    const client = new XMLHttpRequest()
    client.open("GET", this.$withBase("/data/csv/ufo_sighting_data.csv"))
    client.onload = function () {
      const csv = client.responseText
      const features = []

      let prevIndex = csv.indexOf("\n") + 1

      let curIndex
      while ((curIndex = csv.indexOf("\n", prevIndex)) != -1) {
        const line = csv.substr(prevIndex, curIndex - prevIndex).split(",")
        prevIndex = curIndex + 1
        const coords = fromLonLat([parseFloat(line[5]), parseFloat(line[4])])
        if (isNaN(coords[0]) || isNaN(coords[1])) {
          continue
        }
        const shape = line[2]
        shapeTypes[shape] = (shapeTypes[shape] ? shapeTypes[shape] : 0) + 1
        shapeTypes["all"]++

        features.push(
          new Feature({
            datetime: line[0],
            year: parseInt(/[0-9]{4}/.exec(line[0])[0]),
            shape: shape,
            duration: line[3],
            geometry: new Point(coords),
          })
        )
      }
      vectorSource.addFeatures(features)
      fillShapeSelect()
    }
    client.send()
    map.addLayer(
      new WebGLPointsLayer({
        source: vectorSource,
        style: style,
      })
    )
    const info = document.getElementById("info")
    map.on("pointermove", function (evt) {
      if (map.getView().getInteracting() || map.getView().getAnimating()) {
        return
      }
      const pixel = evt.pixel
      info.innerText = ""
      map.forEachFeatureAtPixel(pixel, function (feature) {
        const datetime = feature.get("datetime")
        const duration = feature.get("duration")
        const shape = feature.get("shape")
        info.innerText =
          "On " +
          datetime +
          ", lasted " +
          duration +
          ' seconds and had a "' +
          shape +
          '" shape.'
      })
    })
  },
}
</script>
```

:::

## 3.图标符号

:::demo

```vue
<template>
  <div ref="map" class="map"><div id="popup"></div></div>
</template>

<script>
export default {
  mounted() {
    let {
      Feature,
      Overlay,
      geom: { Point },
      Map,
      View,
      layer: { Tile: TileLayer, Vector: VectorLayer },
      source: { TileJSON, Vector: VectorSource },
      style: { Icon, Style },
    } = ol
    const iconFeature = new Feature({
      geometry: new Point([0, 0]),
      name: "Null Island",
      population: 4000,
      rainfall: 500,
    })
    const iconStyle = new Style({
      image: new Icon({
        anchor: [0.5, 46],
        anchorXUnits: "fraction",
        anchorYUnits: "pixels",
        src: this.$withBase("/data/icon.png"),
      }),
    })
    iconFeature.setStyle(iconStyle)
    const vectorSource = new VectorSource({
      features: [iconFeature],
    })
    const vectorLayer = new VectorLayer({
      source: vectorSource,
    })
    const rasterLayer = new TileLayer({
      source: new TileJSON({
        url: "https://a.tiles.mapbox.com/v3/aj.1x1-degrees.json?secure=1",
        crossOrigin: "",
      }),
    })
    const map = new Map({
      layers: [rasterLayer, vectorLayer],
      target: this.$refs.map,
      view: new View({
        center: [12579156, 3274244],
        zoom: 3,
      }),
    })
    const element = document.getElementById("popup")
    const popup = new Overlay({
      element: element,
      positioning: "bottom-center",
      stopEvent: false,
    })
    map.addOverlay(popup)
    map.on("click", function (evt) {
      const feature = map.forEachFeatureAtPixel(evt.pixel, function (feature) {
        return feature
      })
      if (feature) {
        popup.setPosition(evt.coordinate)
        $(element).popover({
          placement: "top",
          html: true,
          content: feature.get("name"),
        })
        $(element).popover("show")
      } else {
        $(element).popover("dispose")
      }
    })
    map.on("pointermove", function (e) {
      const pixel = map.getEventPixel(e.originalEvent)
      const hit = map.hasFeatureAtPixel(pixel)
      map.getTarget().style.cursor = hit ? "pointer" : ""
    })
    map.on("movestart", function () {
      $(element).popover("dispose")
    })
  },
}
</script>
```

:::

## 3.图标颜色

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      Feature,
      geom: { Point },
      Map,
      View,
      layer: { Tile: TileLayer, Vector: VectorLayer },
      source: { TileJSON, Vector: VectorSource },
      style: { Icon, Style },
      proj: { fromLonLat },
    } = ol
    const rome = new Feature({
      geometry: new Point(fromLonLat([12.5, 41.9])),
    })
    const london = new Feature({
      geometry: new Point(fromLonLat([-0.12755, 51.507222])),
    })
    const madrid = new Feature({
      geometry: new Point(fromLonLat([-3.683333, 40.4])),
    })
    const paris = new Feature({
      geometry: new Point(fromLonLat([2.353, 48.8566])),
    })
    const berlin = new Feature({
      geometry: new Point(fromLonLat([13.3884, 52.5169])),
    })
    rome.setStyle(
      new Style({
        image: new Icon({
          color: "#BADA55",
          crossOrigin: "anonymous",
          imgSize: [20, 20],
          src: this.$withBase("/data/square.svg"),
        }),
      })
    )
    london.setStyle(
      new Style({
        image: new Icon({
          color: "rgba(255, 0, 0, .5)",
          crossOrigin: "anonymous",
          src: this.$withBase("/data/bigdot.png"),
          scale: 0.2,
        }),
      })
    )
    madrid.setStyle(
      new Style({
        image: new Icon({
          crossOrigin: "anonymous",
          src: this.$withBase("/data/bigdot.png"),
          scale: 0.2,
        }),
      })
    )
    paris.setStyle(
      new Style({
        image: new Icon({
          color: "#8959A8",
          crossOrigin: "anonymous",
          imgSize: [20, 20],
          src: this.$withBase("/data/dot.svg"),
        }),
      })
    )
    berlin.setStyle(
      new Style({
        image: new Icon({
          crossOrigin: "anonymous",
          imgSize: [20, 20],
          src: this.$withBase("/data/dot.svg"),
        }),
      })
    )
    const vectorSource = new VectorSource({
      features: [rome, london, madrid, paris, berlin],
    })
    const vectorLayer = new VectorLayer({
      source: vectorSource,
    })
    const rasterLayer = new TileLayer({
      source: new TileJSON({
        url:
          "https://a.tiles.mapbox.com/v4/aj.1x1-degrees.json?secure=1&access_token=" +
          mapkeys.mapbox,
        crossOrigin: "anonymous",
      }),
    })
    const map = new Map({
      layers: [rasterLayer, vectorLayer],
      target: this.$refs.map,
      view: new View({
        center: fromLonLat([2.896372, 44.6024]),
        zoom: 3,
      }),
    })
  },
}
</script>
```

:::

## 4.图标修改

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      Feature,
      geom: { Point },
      Map,
      View,
      layer: { Tile: TileLayer, Vector: VectorLayer },
      source: { TileJSON, Vector: VectorSource },
      style: { Icon, Style },
      interaction: { Modify },
    } = ol

    const iconFeature = new Feature({
      geometry: new Point([0, 0]),
      name: "Null Island",
      population: 4000,
      rainfall: 500,
    })
    const iconStyle = new Style({
      image: new Icon({
        anchor: [0.5, 46],
        anchorXUnits: "fraction",
        anchorYUnits: "pixels",
        src: this.$withBase("/data/icon.png"),
      }),
    })
    iconFeature.setStyle(iconStyle)
    const vectorSource = new VectorSource({
      features: [iconFeature],
    })
    const vectorLayer = new VectorLayer({
      source: vectorSource,
    })
    const rasterLayer = new TileLayer({
      source: new TileJSON({
        url:
          "https://a.tiles.mapbox.com/v4/aj.1x1-degrees.json?secure=1&access_token=" +
          mapkeys.mapbox,
        crossOrigin: "anonymous",
      }),
    })
    const target = this.$refs.map
    const map = new Map({
      layers: [rasterLayer, vectorLayer],
      target: target,
      view: new View({
        center: [12579156, 3274244],
        zoom: 3,
      }),
    })
    const modify = new Modify({
      hitDetection: vectorLayer,
      source: vectorSource,
    })
    modify.on(["modifystart", "modifyend"], function (evt) {
      target.style.cursor = evt.type === "modifystart" ? "grabbing" : "pointer"
    })
    const overlaySource = modify.getOverlay().getSource()
    overlaySource.on(["addfeature", "removefeature"], function (evt) {
      target.style.cursor = evt.type === "addfeature" ? "pointer" : ""
    })
    map.addInteraction(modify)
  },
}
</script>
```

:::

## 5.图标像素操作

:::demo

```vue
<template>
  <div id="map" class="map">
    <div id="popup"></div>
  </div>
</template>

<script>
export default {
  mounted() {
    let {
      Feature,
      Overlay,
      geom: { Point },
      Map,
      View,
      layer: { Tile: TileLayer, Vector: VectorLayer },
      source: { TileJSON, Vector: VectorSource },
      style: { Icon, Style, Text },
      proj: { fromLonLat },
      render: { getVectorContext },
    } = ol
    const rasterLayer = new TileLayer({
      source: new TileJSON({
        url:
          "https://a.tiles.mapbox.com/v4/aj.1x1-degrees.json?secure=1&access_token=" +
          mapkeys.mapbox,
        crossOrigin: "anonymous",
      }),
    })

    const iconFeature = new Feature({
      geometry: new Point(fromLonLat([0, -10])),
      name: "Fish.1",
    })

    const feature1 = new Feature({
      geometry: new Point(fromLonLat([0, -10])),
      name: "Fish.1 Island",
    })

    const feature2 = new Feature({
      geometry: new Point(fromLonLat([-30, 10])),
      name: "Fish.2 Island",
    })

    const iconStyle = new Style({
      image: new Icon({
        anchor: [0.5, 0.9],
        src: this.$withBase("/data/fish.png"),
        crossOrigin: "",
        scale: [0, 0],
        rotation: Math.PI / 4,
      }),
      text: new Text({
        text: "FISH\nTEXT",
        scale: [0, 0],
        rotation: Math.PI / 4,
        textAlign: "center",
        textBaseline: "top",
      }),
    })

    let i = 0
    let j = 45

    iconFeature.setStyle(function () {
      const x = Math.sin((i * Math.PI) / 180) * 3
      const y = Math.sin((j * Math.PI) / 180) * 4
      iconStyle.getImage().setScale([x, y])
      iconStyle.getText().setScale([x, y])
      return iconStyle
    })

    rasterLayer.on("postrender", function (event) {
      const vectorContext = getVectorContext(event)
      const x = Math.cos((i * Math.PI) / 180) * 3
      const y = Math.cos((j * Math.PI) / 180) * 4
      iconStyle.getImage().setScale([x, y])
      iconStyle.getText().setScale([x, y])
      vectorContext.drawFeature(feature2, iconStyle)
    })

    const vectorSource = new VectorSource({
      features: [iconFeature, feature1, feature2],
    })

    const vectorLayer = new VectorLayer({
      source: vectorSource,
    })

    const map = new Map({
      layers: [rasterLayer, vectorLayer],
      target: this.$refs.map,
      view: new View({
        center: fromLonLat([-15, 0]),
        zoom: 3,
      }),
    })

    setInterval(function () {
      i = (i + 4) % 360
      j = (j + 5) % 360
      vectorSource.changed()
    }, 1000)

    const element = document.getElementById("popup")

    const popup = new Overlay({
      element: element,
      positioning: "bottom-center",
      stopEvent: false,
    })
    map.addOverlay(popup)

    // display popup on click
    map.on("click", function (evt) {
      const feature = map.forEachFeatureAtPixel(evt.pixel, function (feature) {
        return feature
      })
      $(element).popover("dispose")
      if (feature) {
        popup.setPosition(evt.coordinate)
        $(element).popover({
          placement: "top",
          html: true,
          animation: false,
          content: feature.get("name"),
        })
        $(element).popover("show")
      }
    })

    // change mouse cursor when over marker
    map.on("pointermove", function (e) {
      const pixel = map.getEventPixel(e.originalEvent)
      const hit = map.hasFeatureAtPixel(pixel)
      map.getTarget().style.cursor = hit ? "pointer" : ""
    })
    // Close the popup when the map is moved
    map.on("movestart", function () {
      $(element).popover("dispose")
    })
  },
}
</script>
```

:::
