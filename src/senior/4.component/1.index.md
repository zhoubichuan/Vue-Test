---
lang: zh-CN
sidebarDepth: 0
meta:
  - name: description
    content: 个人总结的openlayers学习技术文档-语法
  - name: keywords
    content: vuepress,最新技术文档,vuepress语法,markdown语法
---

# 案例

## 1.静态图像

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      Map,
      View,
      layer: { Image: ImageLayer },
      source: { ImageStatic: Static },
      extent: { getCenter },
      proj: { Projection },
    } = ol
    const extent = [0, 0, 1024, 968]
    const projection = new Projection({
      code: "xkcd-image",
      units: "pixels",
      extent: extent,
    })

    const map = new Map({
      layers: [
        new ImageLayer({
          source: new Static({
            attributions: '© <a href="https://xkcd.com/license.html">xkcd</a>',
            url: "https://imgs.xkcd.com/comics/online_communities.png",
            projection: projection,
            imageExtent: extent,
          }),
        }),
      ],
      target: this.$refs.map,
      view: new View({
        projection: projection,
        center: getCenter(extent),
        zoom: 2,
        maxZoom: 8,
      }),
    })
  },
}
</script>
```

:::

## 2.街道标签

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      format: { GeoJSON },
      Map,
      View,
      layer: { Tile: TileLayer, Vector: VectorLayer },
      source: { XYZ, Vector: VectorSource },
      style: { Fill, Style, Text },
      extent: { getCenter },
    } = ol

    const style = new Style({
      text: new Text({
        font: 'bold 11px "Open Sans", "Arial Unicode MS", "sans-serif"',
        placement: "line",
        fill: new Fill({
          color: "white",
        }),
      }),
    })

    const key = "pk.eyJ1IjoiemhvdWJpY2h1YW4iLCJhIjoiY2wyZGRleThpMHk5YjNkcDkzMWNveXB0YSJ9.L0LaQDinn6bNDLgQQmcuxQ"
    const attributions =
      '<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> ' +
      '<a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>'

    const viewExtent = [1817379, 6139595, 1827851, 6143616]
    const map = new Map({
      layers: [
        new TileLayer({
          source: new XYZ({
            attributions: attributions,
            url:
              "https://api.maptiler.com/tiles/satellite/{z}/{x}/{y}.jpg?key=" +
              key,
            maxZoom: 20,
          }),
        }),
        new VectorLayer({
          declutter: true,
          source: new VectorSource({
            format: new GeoJSON(),
            url: "data/geojson/vienna-streets.geojson",
          }),
          style: function (feature) {
            style.getText().setText(feature.get("name"))
            return style
          },
        }),
      ],
      target: this.$refs.map,
      view: new View({
        extent: viewExtent,
        center: getCenter(viewExtent),
        zoom: 17,
        minZoom: 14,
      }),
    })
  },
}
</script>
```

:::

## 3.样式渲染器

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
  <div id="info">&nbsp;</div>
</template>

<script>
export default {
  mounted() {
    let {
      format: { GeoJSON },
      Map,
      View,
      layer: { Vector: VectorLayer },
      source: { Vector: VectorSource },
      style: { Fill, Stroke, Style },
      extent: { getBottomLeft, getHeight, getWidth },
      render: { toContext },
    } = ol

    const fill = new Fill()
    const stroke = new Stroke({
      color: "rgba(255,255,255,0.8)",
      width: 2,
    })
    const style = new Style({
      renderer: function (pixelCoordinates, state) {
        const context = state.context
        const geometry = state.geometry.clone()
        geometry.setCoordinates(pixelCoordinates)
        const extent = geometry.getExtent()
        const width = getWidth(extent)
        const height = getHeight(extent)
        const flag = state.feature.get("flag")
        if (!flag || height < 1 || width < 1) {
          return
        }

        // Stitch out country shape from the blue canvas
        context.save()
        const renderContext = toContext(context, {
          pixelRatio: 1,
        })
        renderContext.setFillStrokeStyle(fill, stroke)
        renderContext.drawGeometry(geometry)
        context.clip()

        // Fill transparent country with the flag image
        const bottomLeft = getBottomLeft(extent)
        const left = bottomLeft[0]
        const bottom = bottomLeft[1]
        context.drawImage(flag, left, bottom, width, height)
        context.restore()
      },
    })

    const vectorLayer = new VectorLayer({
      source: new VectorSource({
        url: "https://openlayersbook.github.io/openlayers_book_samples/assets/data/countries.geojson",
        format: new GeoJSON(),
      }),
      style: style,
    })

    // Load country flags and set them as `flag` attribute on the country feature
    vectorLayer.getSource().on("addfeature", function (event) {
      const feature = event.feature
      const img = new Image()
      img.onload = function () {
        feature.set("flag", img)
      }
      img.src =
        "https://flagcdn.com/w320/" +
        feature.get("iso_a2").toLowerCase() +
        ".png"
    })

    new Map({
      layers: [vectorLayer],
      target: this.$refs.map,
      view: new View({
        center:[12579156, 3274244],
        zoom: 1,
      }),
    })
  },
}
</script>
```

:::

## 4.使用 CanvasGradient 或 CanvasPattern 的造型功能

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      format: { KML },
      Map,
      View,
      layer: { Vector: VectorLayer },
      source: { Vector: VectorSource },
      has: { DEVICE_PIXEL_RATIO },
      style: { Fill, Stroke, Style },
      proj: { fromLonLat },
    } = ol
    const pixelRatio = DEVICE_PIXEL_RATIO
    const canvas = document.createElement("canvas")
    const context = canvas.getContext("2d")
    const gradient = context.createLinearGradient(0, 0, 1024 * pixelRatio, 0)
    gradient.addColorStop(0, "red")
    gradient.addColorStop(1 / 6, "orange")
    gradient.addColorStop(2 / 6, "yellow")
    gradient.addColorStop(3 / 6, "green")
    gradient.addColorStop(4 / 6, "aqua")
    gradient.addColorStop(5 / 6, "blue")
    gradient.addColorStop(1, "purple")

    const vectorLayer = new VectorLayer({
      background: "white",
      source: new VectorSource({
        url: "data/kml/states.kml",
        format: new KML({ extractStyles: false }),
      }),
      style: new Style({
        fill: new Fill({ color: gradient }),
        stroke: new Stroke({
          color: "#333",
          width: 1,
        }),
      }),
    })

    const map = new Map({
      layers: [vectorLayer],
      target: this.$refs.map,
      view: new View({
        center: fromLonLat([-100, 38.5]),
        zoom: 4,
      }),
    })
  },
}
</script>
```

:::

## 5.SVG 图层

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      Map,
      View,
      layer: { Layer },
      transform: { composeCssTransform },
    } = ol
    const map = new Map({
      target: this.$refs.map,
      view: new View({
        center:[12579156, 3274244],
        extent: [-180, -90, 180, 90],
        projection: "EPSG:4326",
        zoom: 2,
      }),
    })

    const svgContainer = document.createElement("div")
    const xhr = new XMLHttpRequest()
    xhr.open("GET", "data/world.svg")
    xhr.addEventListener("load", function () {
      const svg = xhr.responseXML.documentElement
      svgContainer.ownerDocument.importNode(svg)
      svgContainer.appendChild(svg)
    })
    xhr.send()

    const width = 2560
    const height = 1280
    const svgResolution = 360 / width
    svgContainer.style.width = width + "px"
    svgContainer.style.height = height + "px"
    svgContainer.style.transformOrigin = "top left"
    svgContainer.className = "svg-layer"

    map.addLayer(
      new Layer({
        render: function (frameState) {
          const scale = svgResolution / frameState.viewState.resolution
          const center = frameState.viewState.center
          const size = frameState.size
          const cssTransform = composeCssTransform(
            size[0] / 2,
            size[1] / 2,
            scale,
            scale,
            frameState.viewState.rotation,
            -center[0] / svgResolution - width / 2,
            center[1] / svgResolution - height / 2
          )
          svgContainer.style.transform = cssTransform
          svgContainer.style.opacity = this.getOpacity()
          return svgContainer
        },
      })
    )
  },
}
</script>
```

:::
