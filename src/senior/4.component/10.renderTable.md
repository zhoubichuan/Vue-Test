---
lang: zh-CN
sidebarDepth: 2
meta:
  - name: description
    content: 个人总结的openlayers学习技术文档-语法
  - name: keywords
    content: vuepress,最新技术文档,vuepress语法,markdown语法
---

# 十.案例10

## 1.WMS 功能解析

:::demo

```vue
<template>
  <pre class="log-container"><code id="log"></code></pre>
</template>

<script>
export default {
  mounted() {
    let {
      format: { WMSCapabilities },
    } = ol
    const parser = new WMSCapabilities()

    fetch("data/ogcsample.xml")
      .then(function (response) {
        return response.text()
      })
      .then(function (text) {
        const result = parser.read(text)
        document.getElementById("log").innerText = JSON.stringify(
          result,
          null,
          2
        )
      })
  },
}
</script>
```

:::

## 2.WMS GetFeatureInfo（图像层）

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
  <div id="info">&nbsp;</div>
</template>

<script>
export default {
  mounted() {
    let {
      Map,
      View,
      layer: { Image: ImageLayer },
      source: { ImageWMS },
    } = ol
    const wmsSource = new ImageWMS({
      url: "https://ahocevar.com/geoserver/wms",
      params: { LAYERS: "ne:ne" },
      serverType: "geoserver",
      crossOrigin: "anonymous",
    })

    const wmsLayer = new ImageLayer({
      source: wmsSource,
    })

    const view = new View({
      center:[12579156, 3274244],
      zoom: 1,
    })

    const map = new Map({
      layers: [wmsLayer],
      target: this.$refs.map,
      view: view,
    })

    map.on("singleclick", function (evt) {
      document.getElementById("info").innerHTML = ""
      const viewResolution = /** @type {number} */ (view.getResolution())
      const url = wmsSource.getFeatureInfoUrl(
        evt.coordinate,
        viewResolution,
        "EPSG:3857",
        { INFO_FORMAT: "text/html" }
      )
      if (url) {
        fetch(url)
          .then((response) => response.text())
          .then((html) => {
            document.getElementById("info").innerHTML = html
          })
      }
    })

    map.on("pointermove", function (evt) {
      if (evt.dragging) {
        return
      }
      const data = wmsLayer.getData(evt.pixel)
      const hit = data && data[3] > 0 // transparent pixels have zero for data[3]
      map.getTargetElement().style.cursor = hit ? "pointer" : ""
    })
  },
}
</script>
```

:::

## 3.WMS GetFeatureInfo（层）

:::demo

```vue
<template>
  <table id="info">
    <tr>
      <td>All features:</td>
      <td id="all"></td>
    </tr>
    <tr>
      <td>Hotel features:</td>
      <td id="hotel"></td>
    </tr>
    <tr>
      <td>Restaurant features:</td>
      <td id="restaurant"></td>
    </tr>
  </table>
</template>

<script>
export default {
  mounted() {
    let {
      format: { WMSGetFeatureInfo },
    } = ol

    fetch("data/wmsgetfeatureinfo/osm-restaurant-hotel.xml")
      .then(function (response) {
        return response.text()
      })
      .then(function (response) {
        // this is the standard way to read the features
        const allFeatures = new WMSGetFeatureInfo().readFeatures(response)
        document.getElementById("all").innerText = allFeatures.length.toString()

        // when specifying the 'layers' options, only the features of those
        // layers are returned by the format
        const hotelFeatures = new WMSGetFeatureInfo({
          layers: ["hotel"],
        }).readFeatures(response)
        document.getElementById("hotel").innerText =
          hotelFeatures.length.toString()

        const restaurantFeatures = new WMSGetFeatureInfo({
          layers: ["restaurant"],
        }).readFeatures(response)
        document.getElementById("restaurant").innerText =
          restaurantFeatures.length.toString()
      })
  },
}
</script>
```

:::

## 4.WMS GetFeatureInfo（层）

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
  <div id="info">&nbsp;</div>
</template>

<script>
export default {
  mounted() {
    let {
      Map,
      View,
      layer: { Tile: TileLayer },
      source: { TileWMS },
    } = ol

    const wmsSource = new TileWMS({
      url: "https://ahocevar.com/geoserver/wms",
      params: { LAYERS: "ne:ne", TILED: true },
      serverType: "geoserver",
      crossOrigin: "anonymous",
    })

    const wmsLayer = new TileLayer({
      source: wmsSource,
    })

    const view = new View({
      center:[12579156, 3274244],
      zoom: 1,
    })

    const map = new Map({
      layers: [wmsLayer],
      target: this.$refs.map,
      view: view,
    })

    map.on("singleclick", function (evt) {
      document.getElementById("info").innerHTML = ""
      const viewResolution = /** @type {number} */ (view.getResolution())
      const url = wmsSource.getFeatureInfoUrl(
        evt.coordinate,
        viewResolution,
        "EPSG:3857",
        { INFO_FORMAT: "text/html" }
      )
      if (url) {
        fetch(url)
          .then((response) => response.text())
          .then((html) => {
            document.getElementById("info").innerHTML = html
          })
      }
    })

    map.on("pointermove", function (evt) {
      if (evt.dragging) {
        return
      }
      const data = wmsLayer.getData(evt.pixel)
      const hit = data && data[3] > 0 // transparent pixels have zero for data[3]
      map.getTargetElement().style.cursor = hit ? "pointer" : ""
    })
  },
}
</script>
```

:::

## 5.WMS GetLegendGraphic

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
  Legend:
  <div><img id="legend" /></div>
</template>

<script>
export default {
  mounted() {
    let {
      Map,
      View,
      layer: { Tile: TileLayer, Image: ImageLayer },
      source: { OSM, ImageWMS },
    } = ol

    const wmsSource = new ImageWMS({
      url: "https://ahocevar.com/geoserver/wms",
      params: { LAYERS: "topp:states" },
      ratio: 1,
      serverType: "geoserver",
    })

    const updateLegend = function (resolution) {
      const graphicUrl = wmsSource.getLegendUrl(resolution)
      const img = document.getElementById("legend")
      img.src = graphicUrl
    }

    const layers = [
      new TileLayer({
        source: new OSM(),
      }),
      new ImageLayer({
        extent: [-13884991, 2870341, -7455066, 6338219],
        source: wmsSource,
      }),
    ]

    const map = new Map({
      layers: layers,
      target: this.$refs.map,
      view: new View({
        center: [-10997148, 4569099],
        zoom: 4,
      }),
    })

    // Initial legend
    const resolution = map.getView().getResolution()
    updateLegend(resolution)

    // Update the legend when the resolution changes
    map.getView().on("change:resolution", function (event) {
      const resolution = event.target.getResolution()
      updateLegend(resolution)
    })
  },
}
</script>
```

:::
