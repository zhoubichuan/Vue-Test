---
lang: zh-CN
sidebarDepth: 2
meta:
  - name: description
    content: 个人总结的openlayers学习技术文档-语法
  - name: keywords
    content: vuepress,最新技术文档,vuepress语法,markdown语法
---

# 十三.内置类型

## 1.页面滚动

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      Map,
      View,
      layer: { Tile: TileLayer },
      source: { OSM },
    } = ol
    const map = new Map({
      layers: [
        new TileLayer({
          source: new OSM(),
        }),
      ],
      target: this.$refs.map,
      view: new View({
        center: [0, 0],
        zoom: 2,
      }),
    })
  },
}
</script>
```

:::

## 2.平移和页面滚动

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      interaction: { DragPan, MouseWheelZoom, defaults },
      Map,
      View,
      layer: { Tile: TileLayer },
      source: { OSM },
      events: { condition: platformModifierKeyOnly },
    } = ol

    const map = new Map({
      interactions: defaults({ dragPan: false, mouseWheelZoom: false }).extend([
        new DragPan({
          condition: function (event) {
            return (
              this.getPointerCount() === 2 || platformModifierKeyOnly(event)
            )
          },
        }),
        new MouseWheelZoom({
          condition: platformModifierKeyOnly,
        }),
      ]),
      layers: [
        new TileLayer({
          source: new OSM(),
        }),
      ],
      target: this.$refs.map,
      view: new View({
        center: [0, 0],
        zoom: 2,
      }),
    })
  },
}
</script>
```

:::

## 3.永久链接

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      Map,
      View,
      layer: { Tile: TileLayer },
      source: { OSM },
    } = ol
    let zoom = 2
    let center = [0, 0]
    let rotation = 0

    if (window.location.hash !== "") {
      // try to restore center, zoom-level and rotation from the URL
      const hash = window.location.hash.replace("#map=", "")
      const parts = hash.split("/")
      if (parts.length === 4) {
        zoom = parseFloat(parts[0])
        center = [parseFloat(parts[1]), parseFloat(parts[2])]
        rotation = parseFloat(parts[3])
      }
    }

    const map = new Map({
      layers: [
        new TileLayer({
          source: new OSM(),
        }),
      ],
      target: this.$refs.map,
      view: new View({
        center: center,
        zoom: zoom,
        rotation: rotation,
      }),
    })

    let shouldUpdate = true
    const view = map.getView()
    const updatePermalink = function () {
      if (!shouldUpdate) {
        // do not update the URL when the view was changed in the 'popstate' handler
        shouldUpdate = true
        return
      }

      const center = view.getCenter()
      const hash =
        "#map=" +
        view.getZoom().toFixed(2) +
        "/" +
        center[0].toFixed(2) +
        "/" +
        center[1].toFixed(2) +
        "/" +
        view.getRotation()
      const state = {
        zoom: view.getZoom(),
        center: view.getCenter(),
        rotation: view.getRotation(),
      }
      window.history.pushState(state, "map", hash)
    }

    map.on("moveend", updatePermalink)

    // restore the view state when navigating through the history, see
    // https://developer.mozilla.org/en-US/docs/Web/API/WindowEventHandlers/onpopstate
    window.addEventListener("popstate", function (event) {
      if (event.state === null) {
        return
      }
      map.getView().setCenter(event.state.center)
      map.getView().setZoom(event.state.zoom)
      map.getView().setRotation(event.state.rotation)
      shouldUpdate = false
    })
  },
}
</script>
```

:::

## 4.捏合缩放

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      Map,
      View,
      layer: { Tile: TileLayer },
      source: { OSM },
      interaction: { PinchZoom, defaults: defaultInteractions },
    } = ol
    const map = new Map({
      interactions: defaultInteractions().extend([new PinchZoom()]),
      layers: [
        new TileLayer({
          source: new OSM(),
        }),
      ],
      target: this.$refs.map,
      view: new View({
        center: [0, 0],
        zoom: 2,
        constrainResolution: true,
      }),
    })
  },
}
</script>
```

:::

## 5.弹出窗口

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
  <div id="popup" class="ol-popup">
    <a href="#" id="popup-closer" class="ol-popup-closer"></a>
    <div id="popup-content"></div>
  </div>
</template>

<script>
export default {
  mounted() {
    let {
      Overlay,
      coordinate: { toStringHDMS },
      Map,
      View,
      layer: { Tile: TileLayer },
      source: { XYZ },
      proj: { toLonLat },
    } = ol
    const container = document.getElementById("popup")
    const content = document.getElementById("popup-content")
    const closer = document.getElementById("popup-closer")

    /**
     * Create an overlay to anchor the popup to the map.
     */
    const overlay = new Overlay({
      element: container,
      autoPan: {
        animation: {
          duration: 250,
        },
      },
    })

    /**
     * Add a click handler to hide the popup.
     * @return {boolean} Don't follow the href.
     */
    closer.onclick = function () {
      overlay.setPosition(undefined)
      closer.blur()
      return false
    }

    const key = "Get your own API key at https://www.maptiler.com/cloud/"
    const attributions =
      '<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> ' +
      '<a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>'

    /**
     * Create the map.
     */
    const map = new Map({
      layers: [
        new TileLayer({
          source: new XYZ({
            attributions: attributions,
            url:
              "https://api.maptiler.com/maps/streets/{z}/{x}/{y}.png?key=" +
              key,
            tileSize: 512,
          }),
        }),
      ],
      overlays: [overlay],
      target: this.$refs.map,
      view: new View({
        center: [0, 0],
        zoom: 2,
      }),
    })

    /**
     * Add a click handler to the map to render the popup.
     */
    map.on("singleclick", function (evt) {
      const coordinate = evt.coordinate
      const hdms = toStringHDMS(toLonLat(coordinate))

      content.innerHTML = "<p>You clicked here:</p><code>" + hdms + "</code>"
      overlay.setPosition(coordinate)
    })
  },
}
</script>
```

:::
