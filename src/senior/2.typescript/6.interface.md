---
lang: zh-CN
sidebarDepth: 2
meta:
  - name: description
    content: 个人总结的openlayers学习技术文档-语法
  - name: keywords
    content: vuepress,最新技术文档,vuepress语法,markdown语法
---

# 六.案例 6

## 1.图层滑动（WebGL）

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
  <input id="swipe" type="range" style="width: 100%" />
</template>

<script>
export default {
  mounted() {
    let {
      Map,
      View,
      layer: { Tile: TileLayer },
      source: { XYZ, OSM },
      style: Style,
      render: { getRenderPixel },
    } = ol

    const osm = new TileLayer({
      source: new OSM({ wrapX: true }),
    })

    const imagery = new TileLayer({
      source: new XYZ({
        url:
          "https://api.maptiler.com/tiles/satellite/{z}/{x}/{y}.jpg?key=" +
          mapkeys.maptiler,
        attributions:
          '<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> ' +
          '<a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>',
        maxZoom: 20,
      }),
    })

    const map = new Map({
      layers: [osm, imagery],
      target: this.$refs.map,
      view: new View({
        center: [12579156, 3274244],
        zoom: 2,
      }),
    })

    const swipe = document.getElementById("swipe")

    imagery.on("prerender", function (event) {
      const gl = event.context
      gl.enable(gl.SCISSOR_TEST)

      const mapSize = map.getSize() // [width, height] in CSS pixels

      // get render coordinates and dimensions given CSS coordinates
      const bottomLeft = getRenderPixel(event, [0, mapSize[1]])
      const topRight = getRenderPixel(event, [mapSize[0], 0])

      const width = Math.round(
        (topRight[0] - bottomLeft[0]) * (swipe.value / 100)
      )
      const height = topRight[1] - bottomLeft[1]

      gl.scissor(bottomLeft[0], bottomLeft[1], width, height)
    })

    imagery.on("postrender", function (event) {
      const gl = event.context
      gl.disable(gl.SCISSOR_TEST)
    })

    const listener = function () {
      map.render()
    }
    swipe.addEventListener("input", listener)
    swipe.addEventListener("change", listener)
  },
}
</script>
```

:::

## 2.层 Z 索引

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
  <div>
      <label for="idx1">
        <input type="number" id="idx1"></input>
        Square layer Z-index
      </label></br>

      <label for="idx2">
        <input type="number" id="idx2"></input>
        Triangle layer Z-index
      </label>
    </div>
</template>

<script>
export default {
  mounted() {
    let {
      Feature,
      geom: { Point },
      Map,
      View,
      layer: { Vector: VectorLayer },
      source: { Vector: VectorSource },
      style: {Fill, RegularShape, Stroke, Style},
    } = ol
    const stroke = new Stroke({color: 'black', width: 1});

const styles = {
  'square': new Style({
    image: new RegularShape({
      fill: new Fill({color: 'blue'}),
      stroke: stroke,
      points: 4,
      radius: 80,
      angle: Math.PI / 4,
    }),
  }),
  'triangle': new Style({
    image: new RegularShape({
      fill: new Fill({color: 'red'}),
      stroke: stroke,
      points: 3,
      radius: 80,
      rotation: Math.PI / 4,
      angle: 0,
    }),
  }),
  'star': new Style({
    image: new RegularShape({
      fill: new Fill({color: 'green'}),
      stroke: stroke,
      points: 5,
      radius: 80,
      radius2: 4,
      angle: 0,
    }),
  }),
};

function createLayer(coordinates, style, zIndex) {
  const feature = new Feature(new Point(coordinates));
  feature.setStyle(style);

  const source = new VectorSource({
    features: [feature],
  });

  const vectorLayer = new VectorLayer({
    source: source,
  });
  vectorLayer.setZIndex(zIndex);

  return vectorLayer;
}

const layer0 = createLayer([40, 40], styles['star']);
const layer1 = createLayer([0, 0], styles['square'], 1);
const layer2 = createLayer([0, 40], styles['triangle'], 0);

const layers = [];
layers.push(layer1);
layers.push(layer2);

const map = new Map({
  layers: layers,
  target: this.$refs.map,
  view: new View({
    center:[12579156, 3274244],
    zoom: 18,
  }),
});

layer0.setMap(map);

function bindInputs(id, layer) {
  const idxInput = document.getElementById('idx' + id);
  idxInput.onchange = function () {
    layer.setZIndex(parseInt(this.value, 10) || 0);
  };
  idxInput.value = String(layer.getZIndex());
}
bindInputs(1, layer1);
bindInputs(2, layer2);
  },
}
</script>
```

:::

## 3.图层缩放限制

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      Map,
      View,
      layer: { Tile: TileLayer },
      source: { OSM, TileJSON },
      proj: { fromLonLat },
    } = ol

    const map = new Map({
      target: this.$refs.map,
      layers: [
        new TileLayer({
          maxZoom: 14,
          source: new OSM(),
        }),
        new TileLayer({
          minZoom: 14,
          source: new TileJSON({
            url:
              "https://api.maptiler.com/maps/outdoor/tiles.json?key=" +
              mapkeys.maptiler,
            tileSize: 512,
          }),
        }),
      ],
      view: new View({
        center: fromLonLat([-112.18688965, 36.057944835]),
        zoom: 15,
        maxZoom: 18,
        constrainOnlyCenter: true,
      }),
    })
  },
}
</script>
```

:::


## 5.有限的层范围

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
  <button type="button" class="btn btn-default" id="India">India</button>
  <button type="button" class="btn btn-default" id="Argentina">
    Argentina
  </button>
  <button type="button" class="btn btn-default" id="Nigeria">Nigeria</button>
  <button type="button" class="btn btn-default" id="Sweden">Sweden</button>
</template>

<script>
export default {
  mounted() {
    let {
      Map,
      View,
      layer: { Tile: TileLayer },
      source: { TileJSON },
      style: Style,
      proj: { transformExtent },
    } = ol

    function transform(extent) {
      return transformExtent(extent, "EPSG:4326", "EPSG:3857")
    }

    const extents = {
      India: transform([68.17665, 7.96553, 97.40256, 35.49401]),
      Argentina: transform([-73.41544, -55.25, -53.62835, -21.83231]),
      Nigeria: transform([2.6917, 4.24059, 14.57718, 13.86592]),
      Sweden: transform([11.02737, 55.36174, 23.90338, 69.10625]),
    }

    const base = new TileLayer({
      source: new TileJSON({
        url:
          "https://api.tiles.mapbox.com/v4/mapbox.world-light.json?secure&access_token=" +
          mapkeys.mapbox,
        crossOrigin: "anonymous",
      }),
    })

    const overlay = new TileLayer({
      extent: extents.India,
      source: new TileJSON({
        url:
          "https://api.tiles.mapbox.com/v4/mapbox.world-black.json?secure&access_token=" +
          mapkeys.mapbox,
        crossOrigin: "anonymous",
      }),
    })

    const map = new Map({
      layers: [base, overlay],
      target: this.$refs.map,
      view: new View({
        center: [12579156, 3274244],
        zoom: 1,
      }),
    })

    for (const key in extents) {
      document.getElementById(key).onclick = function (event) {
        overlay.setExtent(extents[event.target.id])
      }
    }
  },
}
</script>
```

:::
