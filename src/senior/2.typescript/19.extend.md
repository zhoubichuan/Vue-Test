---
lang: zh-CN
sidebarDepth: 2
meta:
  - name: description
    content: 个人总结的openlayers学习技术文档-语法
  - name: keywords
    content: vuepress,最新技术文档,vuepress语法,markdown语法
---

# 十九.案例 19

## 1.Proj4js 的单个图像 WMS

为坐标变换集成 Proj4js

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      Feature,
      geom: { Circle },
      Map,
      View,
      layer: { Tile: TileLayer, Image: ImageLayer },
      source: { OSM, ImageWMS },
      control: { ScaleLine, defaults: defaultControls },
      proj: {
        Projection,
        fromLonLat,
        proj4: { register },
      },
    } = ol
    proj4.defs(
      "EPSG:21781",
      "+proj=somerc +lat_0=46.95240555555556 +lon_0=7.439583333333333 +k_0=1 " +
        "+x_0=600000 +y_0=200000 +ellps=bessel " +
        "+towgs84=660.077,13.551,369.344,2.484,1.783,2.939,5.66 +units=m +no_defs"
    )
    register(proj4)
    const projection = new Projection({
      code: "EPSG:21781",
      extent: [485869.5728, 76443.1884, 837076.5648, 299941.7864],
    })
    const extent = [420000, 30000, 900000, 350000]
    const layers = [
      new ImageLayer({
        extent: extent,
        source: new ImageWMS({
          url: "https://wms.geo.admin.ch/",
          crossOrigin: "anonymous",
          attributions:
            '© <a href="https://shop.swisstopo.admin.ch/en/products/maps/national/lk1000"' +
            'target="_blank">Pixelmap 1:1000000 / geo.admin.ch</a>',
          params: {
            LAYERS: "ch.swisstopo.pixelkarte-farbe-pk1000.noscale",
            FORMAT: "image/jpeg",
          },
          serverType: "mapserver",
        }),
      }),
      new ImageLayer({
        extent: extent,
        source: new ImageWMS({
          url: "https://wms.geo.admin.ch/",
          crossOrigin: "anonymous",
          attributions:
            '© <a href="https://www.hydrodaten.admin.ch/en/notes-on-the-flood-alert-maps.html"' +
            'target="_blank">Flood Alert / geo.admin.ch</a>',
          params: { LAYERS: "ch.bafu.hydroweb-warnkarte_national" },
          serverType: "mapserver",
        }),
      }),
    ]
    const map = new Map({
      controls: defaultControls().extend([new ScaleLine()]),
      layers: layers,
      target: this.$refs.map,
      view: new View({
        projection: projection,
        center: fromLonLat([8.23, 46.86], projection),
        extent: extent,
        zoom: 2,
      }),
    })
  },
}
</script>
```

:::

## 2.平滑绘制的线条

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
  <form class="form-inline">
    <label for="shall-smoothen">Smooth drawn geometry?</label>
    <input id="shall-smoothen" type="checkbox" checked /><br />
    <label for="iterations">Number of smoothings</label>
    <input
      style="width: 250px;"
      type="range"
      id="iterations"
      min="2"
      max="10"
      step="1"
      value="5"
    />
  </form>
</template>

<script>
export default {
  mounted() {
    let {
      interaction: { Draw },
      Map,
      View,
      layer: { Tile: TileLayer, Vector: VectorLayer },
      source: { OSM, Vector: VectorSource },
      style: Style,
      proj: { fromLonLat },
    } = ol
    function makeSmooth(path, numIterations) {
      numIterations = Math.min(Math.max(numIterations, 1), 10)
      while (numIterations > 0) {
        path = smooth(path)
        numIterations--
      }
      return path
    }
    const vectorSource = new VectorSource({})
    const map = new Map({
      layers: [
        new TileLayer({
          source: new OSM(),
          opacity: 0.5,
        }),
        new VectorLayer({
          source: vectorSource,
        }),
      ],
      target: this.$refs.map,
      view: new View({
        center: [1078373.595, 6871994.591],
        zoom: 5,
      }),
    })
    const shallSmoothen = document.getElementById("shall-smoothen")
    const numIterations = document.getElementById("iterations")
    const draw = new Draw({
      source: vectorSource,
      type: "LineString",
    })
    map.addInteraction(draw)
    draw.on("drawend", function (event) {
      if (!shallSmoothen.checked) {
        return
      }
      const feat = event.feature
      const geometry = feat.getGeometry()
      const coords = geometry.getCoordinates()
      const smoothened = makeSmooth(
        coords,
        parseInt(numIterations.value, 10) || 5
      )
      geometry.setCoordinates(smoothened)
    })
  },
}
</script>
```

:::

## 3.快照交互

将 snap 交互与绘制和修改交互一起使用

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
  <form id="options-form" autocomplete="off">
    <div class="radio">
      <label>
        <input type="radio" name="interaction" value="draw" id="draw" checked />
        Draw &nbsp;
      </label>
      <select name="draw-type" id="draw-type">
        <option value="Point">Point</option>
        <option value="LineString">LineString</option>
        <option value="Polygon">Polygon</option>
        <option value="Circle">Circle</option>
      </select>
    </div>
    <div class="radio">
      <label>
        <input type="radio" name="interaction" value="modify" />
        Modify &nbsp;
      </label>
    </div>
  </form>
</template>

<script>
export default {
  mounted() {
    let {
      interaction: { Draw, Modify, Select, Snap },
      Map,
      View,
      layer: { Tile: TileLayer, Vector: VectorLayer },
      source: { OSM, Vector: VectorSource },
      style: { Circle: CircleStyle, Fill, Stroke, Style },
    } = ol

    const raster = new TileLayer({
      source: new OSM(),
    })

    const vector = new VectorLayer({
      source: new VectorSource(),
      style: new Style({
        fill: new Fill({
          color: "rgba(255, 255, 255, 0.2)",
        }),
        stroke: new Stroke({
          color: "#ffcc33",
          width: 2,
        }),
        image: new CircleStyle({
          radius: 7,
          fill: new Fill({
            color: "#ffcc33",
          }),
        }),
      }),
    })

    const map = new Map({
      layers: [raster, vector],
      target: this.$refs.map,
      view: new View({
        center: [-11000000, 4600000],
        zoom: 4,
      }),
    })

    const ExampleModify = {
      init: function () {
        this.select = new Select()
        map.addInteraction(this.select)

        this.modify = new Modify({
          features: this.select.getFeatures(),
        })
        map.addInteraction(this.modify)

        this.setEvents()
      },
      setEvents: function () {
        const selectedFeatures = this.select.getFeatures()

        this.select.on("change:active", function () {
          selectedFeatures.forEach(function (each) {
            selectedFeatures.remove(each)
          })
        })
      },
      setActive: function (active) {
        this.select.setActive(active)
        this.modify.setActive(active)
      },
    }
    ExampleModify.init()

    const optionsForm = document.getElementById("options-form")

    const ExampleDraw = {
      init: function () {
        map.addInteraction(this.Point)
        this.Point.setActive(false)
        map.addInteraction(this.LineString)
        this.LineString.setActive(false)
        map.addInteraction(this.Polygon)
        this.Polygon.setActive(false)
        map.addInteraction(this.Circle)
        this.Circle.setActive(false)
      },
      Point: new Draw({
        source: vector.getSource(),
        type: "Point",
      }),
      LineString: new Draw({
        source: vector.getSource(),
        type: "LineString",
      }),
      Polygon: new Draw({
        source: vector.getSource(),
        type: "Polygon",
      }),
      Circle: new Draw({
        source: vector.getSource(),
        type: "Circle",
      }),
      activeDraw: null,
      setActive: function (active) {
        if (this.activeDraw) {
          this.activeDraw.setActive(false)
          this.activeDraw = null
        }
        if (active) {
          const type = optionsForm.elements["draw-type"].value
          this.activeDraw = this[type]
          this.activeDraw.setActive(true)
        }
      },
    }
    ExampleDraw.init()

    /**
     * Let user change the geometry type.
     * @param {Event} e Change event.
     */
    optionsForm.onchange = function (e) {
      const type = e.target.getAttribute("name")
      if (type == "draw-type") {
        ExampleModify.setActive(false)
        ExampleDraw.setActive(true)
        optionsForm.elements["interaction"].value = "draw"
      } else if (type == "interaction") {
        const interactionType = e.target.value
        if (interactionType == "modify") {
          ExampleDraw.setActive(false)
          ExampleModify.setActive(true)
        } else if (interactionType == "draw") {
          ExampleDraw.setActive(true)
          ExampleModify.setActive(false)
        }
      }
    }

    ExampleDraw.setActive(true)
    ExampleModify.setActive(false)
    const snap = new Snap({
      source: vector.getSource(),
    })
    map.addInteraction(snap)
  },
}
</script>
```

:::

## 4.球体

带有经纬网图层的 Sphere Mollweide 地图

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      format: { GeoJSON },
      Map,
      View,
      layer: { Graticule, Vector: VectorLayer },
      source: { OSM, Vector: VectorSource },
      style: { Fill, Style },
      proj: {
        Projection,
        proj4: { register },
      },
    } = ol
    // import proj4 from 'proj4';
    proj4.defs(
      "ESRI:53009",
      "+proj=moll +lon_0=0 +x_0=0 +y_0=0 +a=6371000 " +
        "+b=6371000 +units=m +no_defs"
    )
    register(proj4)
    const sphereMollweideProjection = new Projection({
      code: "ESRI:53009",
      extent: [
        -18019909.21177587, -9009954.605703328, 18019909.21177587,
        9009954.605703328,
      ],
      worldExtent: [-179, -89.99, 179, 89.99],
    })

    const style = new Style({
      fill: new Fill({
        color: "#eeeeee",
      }),
    })

    const map = new Map({
      keyboardEventTarget: document,
      layers: [
        new VectorLayer({
          source: new VectorSource({
            url: "https://openlayers.org/data/vector/ecoregions.json",
            format: new GeoJSON(),
          }),
          style: function (feature) {
            const color = feature.get("COLOR_BIO") || "#eeeeee"
            style.getFill().setColor(color)
            return style
          },
        }),
        new Graticule(),
      ],
      target: this.$refs.map,
      view: new View({
        center: [12579156, 3274244],
        projection: sphereMollweideProjection,
        zoom: 2,
      }),
    })
  },
}
</script>
```

:::
