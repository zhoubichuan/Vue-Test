---
lang: zh-CN
sidebarDepth: 2
meta:
  - name: description
    content: 个人总结的openlayers学习技术文档-语法
  - name: keywords
    content: vuepress,最新技术文档,vuepress语法,markdown语法
---

# 十二.条件类型

## 1.使用 ScaleLine 控件进行 OpenStreetMap 重新投影

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      Map,
      View,
      layer: { Tile: TileLayer, Vector: VectorLayer },
      source: { OSM },
      control: { ScaleLine },
      proj: {
        fromLonLat,
        transformExtent,
        proj4: { register },
      },
    } = ol
    // import proj4 from 'proj4';
    proj4.defs(
      "Indiana-East",
      'PROJCS["IN83-EF",GEOGCS["LL83",DATUM["NAD83",' +
        'SPHEROID["GRS1980",6378137.000,298.25722210]],PRIMEM["Greenwich",0],' +
        'UNIT["Degree",0.017453292519943295]],PROJECTION["Transverse_Mercator"],' +
        'PARAMETER["false_easting",328083.333],' +
        'PARAMETER["false_northing",820208.333],' +
        'PARAMETER["scale_factor",0.999966666667],' +
        'PARAMETER["central_meridian",-85.66666666666670],' +
        'PARAMETER["latitude_of_origin",37.50000000000000],' +
        'UNIT["Foot_US",0.30480060960122]]'
    )
    register(proj4)

    const map = new Map({
      layers: [
        new TileLayer({
          source: new OSM(),
        }),
      ],
      target: this.$refs.map,
      view: new View({
        projection: "Indiana-East",
        center: fromLonLat([-85.685, 39.891], "Indiana-East"),
        zoom: 7,
        extent: transformExtent(
          [-172.54, 23.81, -47.74, 86.46],
          "EPSG:4326",
          "Indiana-East"
        ),
        minZoom: 6,
      }),
    })

    map.addControl(new ScaleLine({ units: "us" }))
  },
}
</script>
```

:::

## 2.OSM 矢量图块

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      format: { TopoJSON },
      Map,
      View,
      layer: { VectorTile: VectorTileLayer },
      source: { VectorTile: VectorTileSource },
      style: { Fill, Stroke, Style },
      proj: { fromLonLat },
    } = ol

    const key = "Your Nextzen API key from https://developers.nextzen.org/"

    const roadStyleCache = {}
    const roadColor = {
      major_road: "#776",
      minor_road: "#ccb",
      highway: "#f39",
    }
    const buildingStyle = new Style({
      fill: new Fill({
        color: "#666",
        opacity: 0.4,
      }),
      stroke: new Stroke({
        color: "#444",
        width: 1,
      }),
    })
    const waterStyle = new Style({
      fill: new Fill({
        color: "#9db9e8",
      }),
    })
    const roadStyle = function (feature) {
      const kind = feature.get("kind")
      const railway = feature.get("railway")
      const sort_key = feature.get("sort_key")
      const styleKey = kind + "/" + railway + "/" + sort_key
      let style = roadStyleCache[styleKey]
      if (!style) {
        let color, width
        if (railway) {
          color = "#7de"
          width = 1
        } else {
          color = roadColor[kind]
          width = kind == "highway" ? 1.5 : 1
        }
        style = new Style({
          stroke: new Stroke({
            color: color,
            width: width,
          }),
          zIndex: sort_key,
        })
        roadStyleCache[styleKey] = style
      }
      return style
    }

    const map = new Map({
      layers: [
        new VectorTileLayer({
          source: new VectorTileSource({
            attributions:
              "&copy; OpenStreetMap contributors, Who’s On First, " +
              "Natural Earth, and openstreetmapdata.com",
            format: new TopoJSON({
              layerName: "layer",
              layers: ["water", "roads", "buildings"],
            }),
            maxZoom: 19,
            url:
              "https://tile.nextzen.org/tilezen/vector/v1/all/{z}/{x}/{y}.topojson?api_key=" +
              key,
          }),
          style: function (feature, resolution) {
            switch (feature.get("layer")) {
              case "water":
                return waterStyle
              case "roads":
                return roadStyle(feature)
              case "buildings":
                return resolution < 10 ? buildingStyle : null
              default:
                return null
            }
          },
        }),
      ],
      target: this.$refs.map,
      view: new View({
        center: fromLonLat([-74.0064, 40.7142]),
        maxZoom: 19,
        zoom: 15,
      }),
    })
  },
}
</script>
```

:::

## 3.OSM XML

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      format: { OSMXML },
      Map,
      View,
      layer: { Vector: VectorLayer },
      source: { XYZ, Vector: VectorSource },
      style: { Circle: CircleStyle, Fill, Stroke, Style },
      loadingstrategy: { bbox: bboxStrategy },
      proj: { transformExtent },
    } = ol
    let map = null

    const styles = {
      amenity: {
        parking: new Style({
          stroke: new Stroke({
            color: "rgba(170, 170, 170, 1.0)",
            width: 1,
          }),
          fill: new Fill({
            color: "rgba(170, 170, 170, 0.3)",
          }),
        }),
      },
      building: {
        ".*": new Style({
          zIndex: 100,
          stroke: new Stroke({
            color: "rgba(246, 99, 79, 1.0)",
            width: 1,
          }),
          fill: new Fill({
            color: "rgba(246, 99, 79, 0.3)",
          }),
        }),
      },
      highway: {
        service: new Style({
          stroke: new Stroke({
            color: "rgba(255, 255, 255, 1.0)",
            width: 2,
          }),
        }),
        ".*": new Style({
          stroke: new Stroke({
            color: "rgba(255, 255, 255, 1.0)",
            width: 3,
          }),
        }),
      },
      landuse: {
        "forest|grass|allotments": new Style({
          stroke: new Stroke({
            color: "rgba(140, 208, 95, 1.0)",
            width: 1,
          }),
          fill: new Fill({
            color: "rgba(140, 208, 95, 0.3)",
          }),
        }),
      },
      natural: {
        tree: new Style({
          image: new CircleStyle({
            radius: 2,
            fill: new Fill({
              color: "rgba(140, 208, 95, 1.0)",
            }),
            stroke: null,
          }),
        }),
      },
    }

    const vectorSource = new VectorSource({
      format: new OSMXML(),
      loader: function (extent, resolution, projection, success, failure) {
        const epsg4326Extent = transformExtent(extent, projection, "EPSG:4326")
        const client = new XMLHttpRequest()
        client.open("POST", "https://overpass-api.de/api/interpreter")
        client.addEventListener("load", function () {
          const features = new OSMXML().readFeatures(client.responseText, {
            featureProjection: map.getView().getProjection(),
          })
          vectorSource.addFeatures(features)
          success(features)
        })
        client.addEventListener("error", failure)
        const query =
          "(node(" +
          epsg4326Extent[1] +
          "," +
          Math.max(epsg4326Extent[0], -180) +
          "," +
          epsg4326Extent[3] +
          "," +
          Math.min(epsg4326Extent[2], 180) +
          ");rel(bn)->.foo;way(bn);node(w)->.foo;rel(bw););out meta;"
        client.send(query)
      },
      strategy: bboxStrategy,
    })

    const vector = new VectorLayer({
      source: vectorSource,
      style: function (feature) {
        for (const key in styles) {
          const value = feature.get(key)
          if (value !== undefined) {
            for (const regexp in styles[key]) {
              if (new RegExp(regexp).test(value)) {
                return styles[key][regexp]
              }
            }
          }
        }
        return null
      },
    })

    const key = "Get your own API key at https://www.maptiler.com/cloud/"
    const attributions =
      '<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> ' +
      '<a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>'

    const raster = new TileLayer({
      source: new XYZ({
        attributions: attributions,
        url:
          "https://api.maptiler.com/tiles/satellite/{z}/{x}/{y}.jpg?key=" + key,
        maxZoom: 20,
      }),
    })

    map = new Map({
      layers: [raster, vector],
      target: this.$refs.map,
      view: new View({
        center: [739218, 5906096],
        maxZoom: 19,
        zoom: 17,
      }),
    })
  },
}
</script>
```

:::

## 4.叠加

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
  <div style="display: none;">
    <!-- Clickable label for Vienna -->
    <a
      class="overlay"
      id="vienna"
      target="_blank"
      href="https://en.wikipedia.org/wiki/Vienna"
      >Vienna</a
    >
    <div id="marker" title="Marker"></div>
    <!-- Popup -->
    <div id="popup" title="Welcome to OpenLayers"></div>
  </div>
</template>

<script>
export default {
  mounted() {
    let {
      Overlay,
      Map,
      View,
      layer: { Tile: TileLayer },
      source: { OSM },
      style: Style,
      proj: { fromLonLat, toLonLat },
      coordinate: { toStringHDMS },
    } = ol
    const layer = new TileLayer({
      source: new OSM(),
    })

    const map = new Map({
      layers: [layer],
      target: this.$refs.map,
      view: new View({
        center: [0, 0],
        zoom: 2,
      }),
    })

    const pos = fromLonLat([16.3725, 48.208889])

    // Popup showing the position the user clicked
    const popup = new Overlay({
      element: document.getElementById("popup"),
    })
    map.addOverlay(popup)

    // Vienna marker
    const marker = new Overlay({
      position: pos,
      positioning: "center-center",
      element: document.getElementById("marker"),
      stopEvent: false,
    })
    map.addOverlay(marker)

    // Vienna label
    const vienna = new Overlay({
      position: pos,
      element: document.getElementById("vienna"),
    })
    map.addOverlay(vienna)

    map.on("click", function (evt) {
      const element = popup.getElement()
      const coordinate = evt.coordinate
      const hdms = toStringHDMS(toLonLat(coordinate))

      $(element).popover("dispose")
      popup.setPosition(coordinate)
      $(element).popover({
        container: element,
        placement: "top",
        animation: false,
        html: true,
        content:
          "<p>The location you clicked was:</p><code>" + hdms + "</code>",
      })
      $(element).popover("show")
    })
  },
}
</script>
```

:::

## 5.概览地图控制

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      control: { OverviewMap, defaults: defaultControls },
      Map,
      View,
      layer: { Tile: TileLayer },
      source: { OSM },
    } = ol
    const source = new OSM()
    const overviewMapControl = new OverviewMap({
      layers: [
        new TileLayer({
          source: source,
        }),
      ],
    })

    const map = new Map({
      controls: defaultControls().extend([overviewMapControl]),
      layers: [
        new TileLayer({
          source: source,
        }),
      ],
      target: this.$refs.map,
      view: new View({
        center: [500000, 6000000],
        zoom: 7,
      }),
    })
  },
}
</script>
```

:::
