---
lang: zh-CN
sidebarDepth: 2
meta:
  - name: description
    content: 个人总结的openlayers学习技术文档-语法
  - name: keywords
    content: vuepress,最新技术文档,vuepress语法,markdown语法
---

# 一.案例1

## 1.高 DPI WMTS

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      format: { WMTSCapabilities },
      Map,
      View,
      layer: { Tile: TileLayer },
      source: {
        WMTS: { optionsFromCapabilities },
      },
      has: { DEVICE_PIXEL_RATIO },
    } = ol
    const capabilitiesUrl = "https://basemap.at/wmts/1.0.0/WMTSCapabilities.xml"
    const hiDPI = DEVICE_PIXEL_RATIO > 1
    const layer = hiDPI ? "bmaphidpi" : "geolandbasemap"
    const tilePixelRatio = hiDPI ? 2 : 1

    const map = new Map({
      target: this.$refs.map,
      view: new View({
        center: [1823849, 6143760],
        zoom: 11,
      }),
    })

    fetch(capabilitiesUrl)
      .then(function (response) {
        return response.text()
      })
      .then(function (text) {
        const result = new WMTSCapabilities().read(text)
        const options = optionsFromCapabilities(result, {
          layer: layer,
          matrixSet: "google3857",
          style: "normal",
        })
        options.tilePixelRatio = tilePixelRatio
        options.attributions =
          'Grundkarte: <a target="_blank" href="https://basemap.at/">basemap.at</a>'
        map.addLayer(
          new TileLayer({
            source: new WMTS(options),
          })
        )
      })
  },
}
</script>
```

:::

## 2.命中容忍度

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
  <span id="status">Try to click the line in the map.</span>
  <form class="form-inline">
    <label for="hitTolerance"
      >Hit tolerance for selecting features: &nbsp;</label
    >
    <select id="hitTolerance" class="form-control">
      <option value="0" selected>0 Pixels</option>
      <option value="5">5 Pixels</option>
      <option value="10">10 Pixels</option>
    </select>
    &nbsp; Area: &nbsp;
    <canvas id="circle" style="vertical-align: middle" />
  </form>
</template>

<script>
export default {
  mounted() {
    let {
      Feature,
      geom: { LineString },
      Map,
      View,
      layer: { Tile: TileLayer, Vector: VectorLayer },
      source: { OSM, Vector: VectorSource },
      style: { Stroke, Style },
    } = ol
    const raster = new TileLayer({
      source: new OSM(),
    })

    const style = new Style({
      stroke: new Stroke({
        color: "black",
        width: 1,
      }),
    })

    const feature = new Feature(
      new LineString([
        [-4000000, 0],
        [4000000, 0],
      ])
    )

    const vector = new VectorLayer({
      source: new VectorSource({
        features: [feature],
      }),
      style: style,
    })

    const map = new Map({
      layers: [raster, vector],
      target: this.$refs.map,
      view: new View({
        center: [0, 0],
        zoom: 2,
      }),
    })

    let hitTolerance

    const statusElement = document.getElementById("status")

    map.on("singleclick", function (e) {
      let hit = false
      map.forEachFeatureAtPixel(
        e.pixel,
        function () {
          hit = true
        },
        {
          hitTolerance: hitTolerance,
        }
      )
      if (hit) {
        style.getStroke().setColor("green")
        statusElement.innerHTML = "A feature got hit!"
      } else {
        style.getStroke().setColor("black")
        statusElement.innerHTML = "No feature got hit."
      }
      feature.changed()
    })

    const selectHitToleranceElement = document.getElementById("hitTolerance")
    const circleCanvas = document.getElementById("circle")

    const changeHitTolerance = function () {
      hitTolerance = parseInt(selectHitToleranceElement.value, 10)

      const size = 2 * hitTolerance + 2
      circleCanvas.width = size
      circleCanvas.height = size
      const ctx = circleCanvas.getContext("2d")
      ctx.clearRect(0, 0, size, size)
      ctx.beginPath()
      ctx.arc(
        hitTolerance + 1,
        hitTolerance + 1,
        hitTolerance + 0.5,
        0,
        2 * Math.PI
      )
      ctx.fill()
      ctx.stroke()
    }

    selectHitToleranceElement.onchange = changeHitTolerance
    changeHitTolerance()
  },
}
</script>
```

:::

## 3.图标颜色

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      Feature,
      geom: { Point },
      Map,
      View,
      layer: { Tile: TileLayer, Vector: VectorLayer },
      source: { TileJSON, Vector: VectorSource },
      style: { Icon, Style },
      proj: { fromLonLat },
    } = ol
    const rome = new Feature({
      geometry: new Point(fromLonLat([12.5, 41.9])),
    })

    const london = new Feature({
      geometry: new Point(fromLonLat([-0.12755, 51.507222])),
    })

    const madrid = new Feature({
      geometry: new Point(fromLonLat([-3.683333, 40.4])),
    })
    const paris = new Feature({
      geometry: new Point(fromLonLat([2.353, 48.8566])),
    })
    const berlin = new Feature({
      geometry: new Point(fromLonLat([13.3884, 52.5169])),
    })

    rome.setStyle(
      new Style({
        image: new Icon({
          color: "#BADA55",
          crossOrigin: "anonymous",
          // For Internet Explorer 11
          imgSize: [20, 20],
          src: "data/square.svg",
        }),
      })
    )

    london.setStyle(
      new Style({
        image: new Icon({
          color: "rgba(255, 0, 0, .5)",
          crossOrigin: "anonymous",
          src: "data/bigdot.png",
          scale: 0.2,
        }),
      })
    )

    madrid.setStyle(
      new Style({
        image: new Icon({
          crossOrigin: "anonymous",
          src: "data/bigdot.png",
          scale: 0.2,
        }),
      })
    )

    paris.setStyle(
      new Style({
        image: new Icon({
          color: "#8959A8",
          crossOrigin: "anonymous",
          // For Internet Explorer 11
          imgSize: [20, 20],
          src: "data/dot.svg",
        }),
      })
    )

    berlin.setStyle(
      new Style({
        image: new Icon({
          crossOrigin: "anonymous",
          // For Internet Explorer 11
          imgSize: [20, 20],
          src: "data/dot.svg",
        }),
      })
    )
    const vectorSource = new VectorSource({
      features: [rome, london, madrid, paris, berlin],
    })

    const vectorLayer = new VectorLayer({
      source: vectorSource,
    })

    const rasterLayer = new TileLayer({
      source: new TileJSON({
        url: "https://a.tiles.mapbox.com/v3/aj.1x1-degrees.json?secure=1",
        crossOrigin: "",
      }),
    })

    const map = new Map({
      layers: [rasterLayer, vectorLayer],
      target: this.$refs.map,
      view: new View({
        center: fromLonLat([2.896372, 44.6024]),
        zoom: 3,
      }),
    })
  },
}
</script>
```

:::

## 4.图标修改

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      Feature,
      geom: { Point },
      Map,
      View,
      layer: { Tile: TileLayer, Vector: VectorLayer },
      source: { TileJSON, Vector: VectorSource },
      style: { Icon, Style },
      interaction: { Modify },
    } = ol

    const iconFeature = new Feature({
      geometry: new Point([0, 0]),
      name: "Null Island",
      population: 4000,
      rainfall: 500,
    })

    const iconStyle = new Style({
      image: new Icon({
        anchor: [0.5, 46],
        anchorXUnits: "fraction",
        anchorYUnits: "pixels",
        src: "data/icon.png",
      }),
    })

    iconFeature.setStyle(iconStyle)

    const vectorSource = new VectorSource({
      features: [iconFeature],
    })

    const vectorLayer = new VectorLayer({
      source: vectorSource,
    })

    const rasterLayer = new TileLayer({
      source: new TileJSON({
        url: "https://a.tiles.mapbox.com/v3/aj.1x1-degrees.json?secure=1",
        crossOrigin: "",
      }),
    })

    const target = this.$refs.map
    const map = new Map({
      layers: [rasterLayer, vectorLayer],
      target: target,
      view: new View({
        center: [0, 0],
        zoom: 3,
      }),
    })

    const modify = new Modify({
      hitDetection: vectorLayer,
      source: vectorSource,
    })
    modify.on(["modifystart", "modifyend"], function (evt) {
      target.style.cursor = evt.type === "modifystart" ? "grabbing" : "pointer"
    })
    const overlaySource = modify.getOverlay().getSource()
    overlaySource.on(["addfeature", "removefeature"], function (evt) {
      target.style.cursor = evt.type === "addfeature" ? "pointer" : ""
    })

    map.addInteraction(modify)
  },
}
</script>
```

:::

## 5.图标像素操作

:::demo

```vue
<template>
  <div id="map" class="map">
    <div id="popup"></div>
  </div>
</template>

<script>
export default {
  mounted() {
    let {
      Feature,
      Overlay,
      geom: { Point },
      Map,
      View,
      layer: { Tile: TileLayer, Vector: VectorLayer },
      source: { TileJSON, Vector: VectorSource },
      style: { Icon, Style, Text },
      proj: { fromLonLat },
      render: { getVectorContext },
    } = ol

    const rasterLayer = new TileLayer({
      source: new TileJSON({
        url: "https://a.tiles.mapbox.com/v3/aj.1x1-degrees.json?secure=1",
        crossOrigin: "",
      }),
    })

    const iconFeature = new Feature({
      geometry: new Point(fromLonLat([0, -10])),
      name: "Fish.1",
    })

    const feature1 = new Feature({
      geometry: new Point(fromLonLat([0, -10])),
      name: "Fish.1 Island",
    })

    const feature2 = new Feature({
      geometry: new Point(fromLonLat([-30, 10])),
      name: "Fish.2 Island",
    })

    const iconStyle = new Style({
      image: new Icon({
        anchor: [0.5, 0.9],
        src: "data/fish.png",
        crossOrigin: "",
        scale: [0, 0],
        rotation: Math.PI / 4,
      }),
      text: new Text({
        text: "FISH\nTEXT",
        scale: [0, 0],
        rotation: Math.PI / 4,
        textAlign: "center",
        textBaseline: "top",
      }),
    })

    let i = 0
    let j = 45

    iconFeature.setStyle(function () {
      const x = Math.sin((i * Math.PI) / 180) * 3
      const y = Math.sin((j * Math.PI) / 180) * 4
      iconStyle.getImage().setScale([x, y])
      iconStyle.getText().setScale([x, y])
      return iconStyle
    })

    rasterLayer.on("postrender", function (event) {
      const vectorContext = getVectorContext(event)
      const x = Math.cos((i * Math.PI) / 180) * 3
      const y = Math.cos((j * Math.PI) / 180) * 4
      iconStyle.getImage().setScale([x, y])
      iconStyle.getText().setScale([x, y])
      vectorContext.drawFeature(feature2, iconStyle)
    })

    const vectorSource = new VectorSource({
      features: [iconFeature, feature1, feature2],
    })

    const vectorLayer = new VectorLayer({
      source: vectorSource,
    })

    const map = new Map({
      layers: [rasterLayer, vectorLayer],
      target: this.$refs.map,
      view: new View({
        center: fromLonLat([-15, 0]),
        zoom: 3,
      }),
    })

    setInterval(function () {
      i = (i + 4) % 360
      j = (j + 5) % 360
      vectorSource.changed()
    }, 1000)

    const element = document.getElementById("popup")

    const popup = new Overlay({
      element: element,
      positioning: "bottom-center",
      stopEvent: false,
    })
    map.addOverlay(popup)

    // display popup on click
    map.on("click", function (evt) {
      const feature = map.forEachFeatureAtPixel(evt.pixel, function (feature) {
        return feature
      })
      $(element).popover("dispose")
      if (feature) {
        popup.setPosition(evt.coordinate)
        $(element).popover({
          placement: "top",
          html: true,
          animation: false,
          content: feature.get("name"),
        })
        $(element).popover("show")
      }
    })

    // change mouse cursor when over marker
    map.on("pointermove", function (e) {
      const pixel = map.getEventPixel(e.originalEvent)
      const hit = map.hasFeatureAtPixel(pixel)
      map.getTarget().style.cursor = hit ? "pointer" : ""
    })
    // Close the popup when the map is moved
    map.on("movestart", function () {
      $(element).popover("dispose")
    })
  },
}
</script>
```

:::
