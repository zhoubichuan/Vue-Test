---
lang: zh-CN
sidebarDepth: 2
meta:
  - name: description
    content: 个人总结的openlayers学习技术文档-语法
  - name: keywords
    content: vuepress,最新技术文档,vuepress语法,markdown语法
---

# 十二.案例12

## 1.WMTS 瓦片过渡

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
  <label>
    Sea-level
    <input id="slider" type="range" value="10" max="100" min="-1" />
  </label>
  <span id="theinfo"></span>
</template>

<script>
export default {
  mounted() {
    let {
      proj: { get: getProjection },
      Map,
      View,
      layer: { Tile: TileLayer },
      source: { OSM, WMTS },
      extent: { getTopLeft, getWidth },
      tilegrid: { WMTS: WMTSTileGrid },
    } = ol

    const projection = getProjection("EPSG:3857")
    const tileSizePixels = 256
    const tileSizeMtrs = getWidth(projection.getExtent()) / tileSizePixels
    const matrixIds = []
    const resolutions = []
    for (let i = 0; i <= 14; i++) {
      matrixIds[i] = i
      resolutions[i] = tileSizeMtrs / Math.pow(2, i)
    }
    const tileGrid = new WMTSTileGrid({
      origin: getTopLeft(projection.getExtent()),
      resolutions: resolutions,
      matrixIds: matrixIds,
    })

    const scalgoToken = "CC5BF28A7D96B320C7DFBFD1236B5BEB"

    const wmtsSource = new WMTS({
      url: "https://ts2.scalgo.com/olpatch/wmts?token=" + scalgoToken,
      layer: "SRTM_4_1:SRTM_4_1_flooded_sealevels",
      format: "image/png",
      matrixSet: "EPSG:3857",
      attributions: [
        '<a href="https://scalgo.com" target="_blank">SCALGO</a>',
        '<a href="https://cgiarcsi.community/data/' +
          'srtm-90m-digital-elevation-database-v4-1"' +
          ' target="_blank">CGIAR-CSI SRTM</a>',
      ],
      tileGrid: tileGrid,
      style: "default",
      dimensions: {
        threshold: 100,
      },
    })

    const map = new Map({
      target: this.$refs.map,
      view: new View({
        projection: projection,
        center: [-9871995, 3566245],
        zoom: 6,
      }),
      layers: [
        new TileLayer({
          source: new OSM(),
        }),
        new TileLayer({
          opacity: 0.5,
          source: wmtsSource,
        }),
      ],
    })

    const slider = document.getElementById("slider")
    const updateSourceDimension = function () {
      wmtsSource.updateDimensions({ threshold: slider.value })
      document.getElementById("theinfo").innerHTML = slider.value + " meters"
    }
    slider.addEventListener("input", updateSourceDimension)
    slider.addEventListener("change", updateSourceDimension)
    updateSourceDimension()
  },
}
</script>
```

:::

## 2.工人

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      Map,
      View,
      layer: { Tile: TileLayer },
      source: { OSM },
      worker: {
        version: { create: createVersionWorker },
      },
    } = ol

    const map = new Map({
      layers: [
        new TileLayer({
          source: new OSM(),
        }),
      ],
      target: this.$refs.map,
      view: new View({
        center:[12579156, 3274244],
        zoom: 2,
      }),
    })

    const worker = createVersionWorker()
    worker.addEventListener("error", function (error) {
      console.error("worker error", error)
    })

    worker.addEventListener("message", function (event) {
      console.log("message from worker:", event.data)
    })

    map.on("moveend", function (event) {
      const state = event.frameState.viewState
      worker.postMessage({ zoom: state.zoom, center: state.center })
    })
  },
}
</script>
```

:::

## 3.XYZ

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      Map,
      View,
      layer: { Tile: TileLayer },
      source: { XYZ },
    } = ol
    const map = new Map({
      target: this.$refs.map,
      layers: [
        new TileLayer({
          source: new XYZ({
            url:
              "https://{a-c}.tile.thunderforest.com/cycle/{z}/{x}/{y}.png" +
              "?apikey=Your API key from https://www.thunderforest.com/docs/apikeys/ here",
          }),
        }),
      ],
      view: new View({
        center: [-472202, 7530279],
        zoom: 12,
      }),
    })
  },
}
</script>
```

:::

## 4.XYZ Esri

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      Map,
      View,
      layer: { Tile: TileLayer },
      source: { XYZ },
      proj: { fromLonLat },
    } = ol

    const map = new Map({
      target: this.$refs.map,
      layers: [
        new TileLayer({
          source: new XYZ({
            attributions:
              'Tiles © <a href="https://services.arcgisonline.com/ArcGIS/' +
              'rest/services/World_Topo_Map/MapServer">ArcGIS</a>',
            url:
              "https://server.arcgisonline.com/ArcGIS/rest/services/" +
              "World_Topo_Map/MapServer/tile/{z}/{y}/{x}",
          }),
        }),
      ],
      view: new View({
        center: fromLonLat([-121.1, 47.5]),
        zoom: 7,
      }),
    })
  },
}
</script>
```

:::

## 5.XYZ 视网膜瓦片

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      Map,
      View,
      layer: { Tile: TileLayer },
      source: { OSM, XYZ },
      proj: { fromLonLat },
    } = ol

    const attributions =
      '<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> ' +
      '<a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>'

    const map = new Map({
      target: this.$refs.map,
      layers: [
        new TileLayer({
          source: new OSM(),
        }),
        new TileLayer({
          source: new XYZ({
            attributions: attributions,
            url:
              "https://api.maptiler.com/maps/outdoor/256/{z}/{x}/{y}@2x.png?key=" +
              mapkeys.maptiler,
            tilePixelRatio: 2, // THIS IS IMPORTANT
          }),
        }),
      ],
      view: new View({
        projection: "EPSG:3857",
        center: transform(
          [-112.18688965, 36.057944835],
          "EPSG:4326",
          "EPSG:3857"
        ),
        zoom: 12,
      }),
    })
  },
}
</script>
```

:::
