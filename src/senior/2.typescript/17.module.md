---
lang: zh-CN
sidebarDepth: 2
meta:
  - name: description
    content: 个人总结的openlayers学习技术文档-语法
  - name: keywords
    content: vuepress,最新技术文档,vuepress语法,markdown语法
---

# 十七.案例17

## 1.海平面（带 WebGL）

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
  <label>
    Sea level
    <input id="level" type="range" min="0" max="100" value="1" />
    +<span id="output"></span> m
  </label>
  <br />
  Go to
  <a class="location" data-center="-122.3267,37.8377" data-zoom="11"
    >San Francisco</a
  >,
  <a class="location" data-center="-73.9338,40.6861" data-zoom="11">New York</a
  >,
  <a class="location" data-center="72.9481,18.9929" data-zoom="11">Mumbai</a>,
  or
  <a class="location" data-center="120.831,31.160" data-zoom="9">Shanghai</a>
</template>

<script>
export default {
  mounted() {
    let {
      Map,
      View,
      layer: { WebGLTile: TileLayer },
      source: { XYZ },
      proj: { fromLonLat },
    } = ol

    const attributions =
      '<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> ' +
      '<a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>'
    const elevation = [
      "+",
      -10000,
      [
        "*",
        0.1 * 255,
        [
          "+",
          ["*", 256 * 256, ["band", 1]],
          ["+", ["*", 256, ["band", 2]], ["band", 3]],
        ],
      ],
    ]
    const layer = new TileLayer({
      opacity: 0.6,
      source: new XYZ({
        url:
          "https://api.maptiler.com/tiles/terrain-rgb/{z}/{x}/{y}.png?key=" +
          mapkeys.maptiler,
        tileSize: 512,
        maxZoom: 12,
      }),
      style: {
        variables: {
          level: 0,
        },
        color: [
          "case",
          ["<=", elevation, ["var", "level"]],
          [139, 212, 255, 1],
          [139, 212, 255, 0],
        ],
      },
    })
    const map = new Map({
      target: this.$refs.map,
      layers: [
        new TileLayer({
          source: new XYZ({
            url:
              "https://api.maptiler.com/maps/streets/{z}/{x}/{y}.png?key=" +
              key,
            attributions: attributions,
            tileSize: 512,
            maxZoom: 22,
          }),
        }),
        layer,
      ],
      view: new View({
        center: fromLonLat([-122.3267, 37.8377]),
        zoom: 11,
      }),
    })
    const control = document.getElementById("level")
    const output = document.getElementById("output")
    const listener = function () {
      output.innerText = control.value
      layer.updateStyleVariables({ level: parseFloat(control.value) })
    }
    control.addEventListener("input", listener)
    control.addEventListener("change", listener)
    output.innerText = control.value
    const locations = document.getElementsByClassName("location")
    for (let i = 0, ii = locations.length; i < ii; ++i) {
      locations[i].addEventListener("click", relocate)
    }
    function relocate(event) {
      const data = event.target.dataset
      const view = map.getView()
      view.setCenter(fromLonLat(data.center.split(",").map(Number)))
      view.setZoom(Number(data.zoom))
    }
  },
}
</script>
```

:::

## 2.选择功能

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
  <form class="form-inline">
    <label for="type">Action type &nbsp;</label>
    <select id="type" class="form-control">
      <option value="click" selected>Click</option>
      <option value="singleclick">Single-click</option>
      <option value="pointermove">Hover</option>
      <option value="altclick">Alt+Click</option>
      <option value="none">None</option>
    </select>
    <span id="status">&nbsp;0 selected features</span>
  </form>
</template>

<script>
export default {
  mounted() {
    let {
      format: { GeoJSON },
      Map,
      View,
      layer: { Vector: VectorLayer },
      source: { Vector: VectorSource },
      style: { Fill, Stroke, Style },
      interaction: { Select },
      events: {
        condition: { altKeyOnly, click, pointerMove },
      },
    } = ol
    const style = new Style({
      fill: new Fill({
        color: "#eeeeee",
      }),
    })
    const vector = new VectorLayer({
      source: new VectorSource({
        url: "https://openlayers.org/data/vector/ecoregions.json",
        format: new GeoJSON(),
      }),
      background: "white",
      style: function (feature) {
        const color = feature.get("COLOR") || "#eeeeee"
        style.getFill().setColor(color)
        return style
      },
    })
    const map = new Map({
      layers: [vector],
      target: this.$refs.map,
      view: new View({
        center:[12579156, 3274244],
        zoom: 2,
      }),
    })
    let select = null 
    const selected = new Style({
      fill: new Fill({
        color: "#eeeeee",
      }),
      stroke: new Stroke({
        color: "rgba(255, 255, 255, 0.7)",
        width: 2,
      }),
    })
    function selectStyle(feature) {
      const color = feature.get("COLOR") || "#eeeeee"
      selected.getFill().setColor(color)
      return selected
    }
    const selectSingleClick = new Select({ style: selectStyle })
    const selectClick = new Select({
      condition: click,
      style: selectStyle,
    })
    const selectPointerMove = new Select({
      condition: pointerMove,
      style: selectStyle,
    })
    const selectAltClick = new Select({
      style: selectStyle,
      condition: function (mapBrowserEvent) {
        return click(mapBrowserEvent) && altKeyOnly(mapBrowserEvent)
      },
    })
    const selectElement = document.getElementById("type")
    const changeInteraction = function () {
      if (select !== null) {
        map.removeInteraction(select)
      }
      const value = selectElement.value
      if (value == "singleclick") {
        select = selectSingleClick
      } else if (value == "click") {
        select = selectClick
      } else if (value == "pointermove") {
        select = selectPointerMove
      } else if (value == "altclick") {
        select = selectAltClick
      } else {
        select = null
      }
      if (select !== null) {
        map.addInteraction(select)
        select.on("select", function (e) {
          document.getElementById("status").innerHTML =
            "&nbsp;" +
            e.target.getFeatures().getLength() +
            " selected features (last operation selected " +
            e.selected.length +
            " and deselected " +
            e.deselected.length +
            " features)"
        })
      }
    }
    selectElement.onchange = changeInteraction
    changeInteraction()
  },
}
</script>
```

:::

## 3.通过悬停选择功能

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
  <span id="status">&nbsp;</span>
</template>

<script>
export default {
  mounted() {
    let {
      format: { GeoJSON },
      Map,
      View,
      layer: { Vector: VectorLayer },
      source: { Vector: VectorSource },
      style: { Fill, Stroke, Style },
    } = ol

    const style = new Style({
      fill: new Fill({
        color: "#eeeeee",
      }),
    })

    const vector = new VectorLayer({
      source: new VectorSource({
        url: "https://openlayers.org/data/vector/ecoregions.json",
        format: new GeoJSON(),
      }),
      background: "white",
      style: function (feature) {
        const color = feature.get("COLOR") || "#eeeeee"
        style.getFill().setColor(color)
        return style
      },
    })

    const map = new Map({
      layers: [vector],
      target: this.$refs.map,
      view: new View({
        center:[12579156, 3274244],
        zoom: 2,
      }),
    })

    const selectStyle = new Style({
      fill: new Fill({
        color: "#eeeeee",
      }),
      stroke: new Stroke({
        color: "rgba(255, 255, 255, 0.7)",
        width: 2,
      }),
    })

    const status = document.getElementById("status")

    let selected = null
    map.on("pointermove", function (e) {
      if (selected !== null) {
        selected.setStyle(undefined)
        selected = null
      }

      map.forEachFeatureAtPixel(e.pixel, function (f) {
        selected = f
        selectStyle.getFill().setColor(f.get("COLOR") || "#eeeeee")
        f.setStyle(selectStyle)
        return true
      })

      if (selected) {
        status.innerHTML = selected.get("ECO_NAME")
      } else {
        status.innerHTML = "&nbsp;"
      }
    })
  },
}
</script>
```

:::

## 4.选择多个功能

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
  <span id="status">&nbsp;0 selected features</span>
</template>

<script>
export default {
  mounted() {
    let {
      format: { GeoJSON },
      Map,
      View,
      layer: { Vector: VectorLayer },
      source: { Vector: VectorSource },
      style: { Fill, Stroke, Style },
      proj: { fromLonLat },
    } = ol
    const highlightStyle = new Style({
      fill: new Fill({
        color: "#EEE",
      }),
      stroke: new Stroke({
        color: "#3399CC",
        width: 2,
      }),
    })
    const vector = new VectorLayer({
      background: "white",
      source: new VectorSource({
        url: "https://openlayers.org/data/vector/us-states.json",
        format: new GeoJSON(),
      }),
    })
    const map = new Map({
      layers: [vector],
      target: this.$refs.map,
      view: new View({
        center: fromLonLat([-100, 38.5]),
        zoom: 4,
        multiWorld: true,
      }),
    })
    const selected = []
    const status = document.getElementById("status")
    map.on("singleclick", function (e) {
      map.forEachFeatureAtPixel(e.pixel, function (f) {
        const selIndex = selected.indexOf(f)
        if (selIndex < 0) {
          selected.push(f)
          f.setStyle(highlightStyle)
        } else {
          selected.splice(selIndex, 1)
          f.setStyle(undefined)
        }
      })
      status.innerHTML = "&nbsp;" + selected.length + " selected features"
    })
  },
}
</script>
```

:::

## 5.半透明层

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      Map,
      View,
      layer: { Tile: TileLayer },
      source: { TileJSON, OSM },
      proj: { fromLonLat },
    } = ol
    const map = new Map({
      layers: [
        new TileLayer({
          className: "bw",
          source: new OSM(),
        }),
        new TileLayer({
          source: new TileJSON({
            url:
              "https://api.tiles.mapbox.com/v4/mapbox.va-quake-aug.json?secure&access_token=" +
              mapkeys.maptiler,
            crossOrigin: "anonymous",
            transition: 0,
          }),
        }),
      ],
      target: this.$refs.map,
      view: new View({
        center: fromLonLat([-77.93255, 37.9555]),
        zoom: 7,
      }),
    })
  },
}
</script>
```

:::
