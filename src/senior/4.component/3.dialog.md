---
lang: zh-CN
sidebarDepth: 2
meta:
  - name: description
    content: 个人总结的openlayers学习技术文档-语法
  - name: keywords
    content: vuepress,最新技术文档,vuepress语法,markdown语法
---

# 四.案例 4

## 4.turf.js

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      format: { GeoJSON },
      Map,
      View,
      layer: { Tile: TileLayer, Vector: VectorLayer },
      source: { OSM, Vector: VectorSource },
      proj: { fromLonLat },
    } = ol
    const source = new VectorSource()
    fetch(this.$withBase("/data/geojson/roads-seoul.geojson"))
      .then(function (response) {
        return response.json()
      })
      .then(function (json) {
        const format = new GeoJSON()
        const features = format.readFeatures(json)
        const street = features[0]
        const turfLine = format.writeFeatureObject(street)
        const distance = 0.2
        const length = turf.lineDistance(turfLine, "kilometers")
        for (let i = 1; i <= length / distance; i++) {
          const turfPoint = turf.along(turfLine, i * distance, "kilometers")
          const marker = format.readFeature(turfPoint)
          marker.getGeometry().transform("EPSG:4326", "EPSG:3857")
          source.addFeature(marker)
        }
        street.getGeometry().transform("EPSG:4326", "EPSG:3857")
        source.addFeature(street)
      })
    const vectorLayer = new VectorLayer({
      source: source,
    })
    const rasterLayer = new TileLayer({
      source: new OSM(),
    })
    const map = new Map({
      layers: [rasterLayer, vectorLayer],
      target: document.getElementById("map"),
      view: new View({
        center: fromLonLat([126.980366, 37.52654]),
        zoom: 15,
      }),
    })
  },
}
</script>
```

:::

## 5.UTFGrid

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
  <div style="display: none;">
    <div id="country-info">
      <div id="country-name">&nbsp;</div>
      <img id="country-flag" />
    </div>
  </div>
</template>

<script>
export default {
  mounted() {
    let {
      Overlay,
      Map,
      View,
      layer: { Tile: TileLayer },
      source: { TileJSON, UTFGrid },
    } = ol

    const mapLayer = new TileLayer({
      source: new TileJSON({
        url:
          "https://api.tiles.mapbox.com/v4/mapbox.geography-class.json?secure&access_token=" +
          mapkeys.mapbox,
      }),
    })
    const gridSource = new UTFGrid({
      url:
        "https://api.tiles.mapbox.com/v4/mapbox.geography-class.json?secure&access_token=" +
        mapkeys.mapbox,
    })
    const gridLayer = new TileLayer({ source: gridSource })
    const view = new View({
      center: [12579156, 3274244],
      zoom: 1,
    })
    const mapElement = document.getElementById("map")
    const map = new Map({
      layers: [mapLayer, gridLayer],
      target: mapElement,
      view: view,
    })
    const infoElement = document.getElementById("country-info")
    const flagElement = document.getElementById("country-flag")
    const nameElement = document.getElementById("country-name")
    const infoOverlay = new Overlay({
      element: infoElement,
      offset: [15, 15],
      stopEvent: false,
    })
    map.addOverlay(infoOverlay)
    const displayCountryInfo = function (coordinate) {
      const viewResolution = /** @type {number} */ (view.getResolution())
      gridSource.forDataAtCoordinateAndResolution(
        coordinate,
        viewResolution,
        function (data) {
          mapElement.style.cursor = data ? "pointer" : ""
          if (data) {
            flagElement.src = "data:image/png;base64," + data["flag_png"]
            nameElement.innerHTML = data["admin"]
          }
          infoOverlay.setPosition(data ? coordinate : undefined)
        }
      )
    }
    map.on("pointermove", function (evt) {
      if (evt.dragging) {
        return
      }
      const coordinate = map.getEventCoordinate(evt.originalEvent)
      displayCountryInfo(coordinate)
    })
    map.on("click", function (evt) {
      displayCountryInfo(evt.coordinate)
    })
  },
}
</script>
```

:::
