---
lang: zh-CN
sidebarDepth: 2
meta:
  - name: description
    content: 个人总结的openlayers学习技术文档-语法
  - name: keywords
    content: vuepress,最新技术文档,vuepress语法,markdown语法
---

# 十一.案例11

## 1.WMS 时间

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
  <div role="group" aria-label="Animation controls">
    <button id="play" type="button">Play</button>
    <button id="pause" type="button">Pause</button>
    <span id="info"></span>
  </div>
</template>

<script>
export default {
  mounted() {
    let {
      extent: { getCenter },
      Map,
      View,
      layer: { Tile: TileLayer },
      source: { Stamen, TileWMS },
      proj: { transformExtent },
    } = ol
    function threeHoursAgo() {
      return new Date(Math.round(Date.now() / 3600000) * 3600000 - 3600000 * 3)
    }

    const extent = transformExtent(
      [-126, 24, -66, 50],
      "EPSG:4326",
      "EPSG:3857"
    )
    let startDate = threeHoursAgo()
    const frameRate = 0.5 // frames per second
    let animationId = null

    const layers = [
      new TileLayer({
        source: new Stamen({
          layer: "terrain",
        }),
      }),
      new TileLayer({
        extent: extent,
        source: new TileWMS({
          attributions: ["Iowa State University"],
          url: "https://mesonet.agron.iastate.edu/cgi-bin/wms/nexrad/n0r-t.cgi",
          params: { LAYERS: "nexrad-n0r-wmst" },
        }),
      }),
    ]
    const map = new Map({
      layers: layers,
      target: this.$refs.map,
      view: new View({
        center: getCenter(extent),
        zoom: 4,
      }),
    })

    function updateInfo() {
      const el = document.getElementById("info")
      el.innerHTML = startDate.toISOString()
    }

    function setTime() {
      startDate.setMinutes(startDate.getMinutes() + 15)
      if (startDate > Date.now()) {
        startDate = threeHoursAgo()
      }
      layers[1].getSource().updateParams({ TIME: startDate.toISOString() })
      updateInfo()
    }
    setTime()

    const stop = function () {
      if (animationId !== null) {
        window.clearInterval(animationId)
        animationId = null
      }
    }

    const play = function () {
      stop()
      animationId = window.setInterval(setTime, 1000 / frameRate)
    }

    const startButton = document.getElementById("play")
    startButton.addEventListener("click", play, false)

    const stopButton = document.getElementById("pause")
    stopButton.addEventListener("click", stop, false)

    updateInfo()
  },
}
</script>
```

:::

## 2.没有投影的 WMS

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      Map,
      View,
      layer: { Tile: TileLayer, Image: ImageLayer },
      source: { ImageWMS, TileWMS },
      control: { ScaleLine, defaults: defaultControls },
      proj: { Projection },
    } = ol

    const layers = [
      new TileLayer({
        source: new TileWMS({
          attributions:
            '© <a href="https://shop.swisstopo.admin.ch/en/products/maps/national/lk1000"' +
            'target="_blank">Pixelmap 1:1000000 / geo.admin.ch</a>',
          crossOrigin: "anonymous",
          params: {
            LAYERS: "ch.swisstopo.pixelkarte-farbe-pk1000.noscale",
            FORMAT: "image/jpeg",
          },
          url: "https://wms.geo.admin.ch/",
        }),
      }),
      new ImageLayer({
        source: new ImageWMS({
          attributions:
            '© <a href="https://www.hydrodaten.admin.ch/en/notes-on-the-flood-alert-maps.html"' +
            'target="_blank">Flood Alert / geo.admin.ch</a>',
          crossOrigin: "anonymous",
          params: { LAYERS: "ch.bafu.hydroweb-warnkarte_national" },
          serverType: "mapserver",
          url: "https://wms.geo.admin.ch/",
        }),
      }),
    ]

    const projection = new Projection({
      code: "EPSG:21781",
      units: "m",
    })

    const map = new Map({
      controls: defaultControls().extend([new ScaleLine()]),
      layers: layers,
      target: this.$refs.map,
      view: new View({
        center: [660000, 190000],
        projection: projection,
        zoom: 9,
      }),
    })
  },
}
</script>
```

:::

## 3.WMTS

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      tilegrid: { WMTS: WMTSTileGrid },
      Map,
      View,
      layer: { Tile: TileLayer, Vector: VectorLayer },
      source: { OSM, WMTS },
      extent: { getTopLeft, getWidth },
      proj: { get: getProjection },
    } = ol

    const projection = getProjection("EPSG:3857")
    const projectionExtent = projection.getExtent()
    const size = getWidth(projectionExtent) / 256
    const resolutions = new Array(19)
    const matrixIds = new Array(19)
    for (let z = 0; z < 19; ++z) {
      // generate resolutions and matrixIds arrays for this WMTS
      resolutions[z] = size / Math.pow(2, z)
      matrixIds[z] = z
    }

    const map = new Map({
      layers: [
        new TileLayer({
          source: new OSM(),
        }),
        new TileLayer({
          opacity: 0.7,
          source: new WMTS({
            attributions:
              'Tiles © <a href="https://mrdata.usgs.gov/geology/state/"' +
              ' target="_blank">USGS</a>',
            url: "https://mrdata.usgs.gov/mapcache/wmts",
            layer: "sgmc2",
            matrixSet: "GoogleMapsCompatible",
            format: "image/png",
            projection: projection,
            tileGrid: new WMTSTileGrid({
              origin: getTopLeft(projectionExtent),
              resolutions: resolutions,
              matrixIds: matrixIds,
            }),
            style: "default",
            wrapX: true,
          }),
        }),
      ],
      target: this.$refs.map,
      view: new View({
        center: [-11158582, 4813697],
        zoom: 4,
      }),
    })
  },
}
</script>
```

:::

## 4.WMTS 功能解析

:::demo

```vue
<template>
  <pre class="log-container"><code id="log"></code></pre>
</template>

<script>
export default {
  mounted() {
    let {
      format: { WMTSCapabilities },
    } = ol
    const parser = new WMTSCapabilities()

    fetch(this.$withBase("/data/WMTSCapabilities.xml"))
      .then(function (response) {
        return response.text()
      })
      .then(function (text) {
        const result = parser.read(text)
        document.getElementById("log").innerText = JSON.stringify(
          result,
          null,
          2
        )
      })
  },
}
</script>
```

:::

## 5.WMTS 层来自功能

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      Map,
      View,
      layer: { Tile: TileLayer },
      source: {
        OSM,
        WMTS: { optionsFromCapabilities },
      },
      format: { WMTSCapabilities },
    } = ol

    const parser = new WMTSCapabilities()
    let map

    fetch(this.$withBase("/data/WMTSCapabilities.xml"))
      .then(function (response) {
        return response.text()
      })
      .then(function (text) {
        const result = parser.read(text)
        const options = optionsFromCapabilities(result, {
          layer: "layer-7328",
          matrixSet: "EPSG:3857",
        })

        map = new Map({
          layers: [
            new TileLayer({
              source: new OSM(),
              opacity: 0.7,
            }),
            new TileLayer({
              opacity: 1,
              source: new WMTS(options),
            }),
          ],
          target: this.$refs.map,
          view: new View({
            center: [19412406.33, -5050500.21],
            zoom: 5,
          }),
        })
      })
  },
}
</script>
```

:::
