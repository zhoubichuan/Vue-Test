---
lang: zh-CN
sidebarDepth: 2
meta:
  - name: description
    content: 个人总结的openlayers学习技术文档-语法
  - name: keywords
    content: vuepress,最新技术文档,vuepress语法,markdown语法
---

# 十.案例10

## 1.鼠标位置

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
  <div id="mouse-position"></div>
  <form>
    <label for="projection">Projection </label>
    <select id="projection">
      <option value="EPSG:4326">EPSG:4326</option>
      <option value="EPSG:3857">EPSG:3857</option>
    </select>
    <label for="precision">Precision</label>
    <input id="precision" type="number" min="0" max="12" value="4" />
  </form>
</template>

<script>
export default {
  mounted() {
    let {
      control: { MousePosition, defaults: defaultControls },
      Map,
      View,
      layer: { Tile: TileLayer },
      source: { OSM },
      coordinate: { createStringXY },
    } = ol
    const mousePositionControl = new MousePosition({
      coordinateFormat: createStringXY(4),
      projection: "EPSG:4326",
      // comment the following two lines to have the mouse position
      // be placed within the map.
      className: "custom-mouse-position",
      target: document.getElementById("mouse-position"),
    })

    const map = new Map({
      controls: defaultControls().extend([mousePositionControl]),
      layers: [
        new TileLayer({
          source: new OSM(),
        }),
      ],
      target: this.$refs.map,
      view: new View({
        center: [0, 0],
        zoom: 2,
      }),
    })

    const projectionSelect = document.getElementById("projection")
    projectionSelect.addEventListener("change", function (event) {
      mousePositionControl.setProjection(event.target.value)
    })

    const precisionInput = document.getElementById("precision")
    precisionInput.addEventListener("change", function (event) {
      const format = createStringXY(event.target.valueAsNumber)
      mousePositionControl.setCoordinateFormat(format)
    })
  },
}
</script>
```

:::

## 2.Moveend 事件

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
  <label>left: <input readonly="readonly" type="text" id="left" /></label>
  <label>right: <input readonly="readonly" type="text" id="right" /></label>
  <label>bottom: <input readonly="readonly" type="text" id="bottom" /></label>
  <label>top: <input readonly="readonly" type="text" id="top" /></label>
</template>

<script>
export default {
  mounted() {
    let {
      Map,
      View,
      layer: { Tile: TileLayer },
      source: { OSM },
      extent: { getBottomLeft, getTopRight },
      proj: { toLonLat },
    } = ol
    const map = new Map({
      layers: [
        new TileLayer({
          source: new OSM(),
        }),
      ],
      target: this.$refs.map,
      view: new View({
        center: [0, 0],
        zoom: 2,
      }),
    })

    function display(id, value) {
      document.getElementById(id).value = value.toFixed(2)
    }

    function wrapLon(value) {
      const worlds = Math.floor((value + 180) / 360)
      return value - worlds * 360
    }

    function onMoveEnd(evt) {
      const map = evt.map
      const extent = map.getView().calculateExtent(map.getSize())
      const bottomLeft = toLonLat(getBottomLeft(extent))
      const topRight = toLonLat(getTopRight(extent))
      display("left", wrapLon(bottomLeft[0]))
      display("bottom", bottomLeft[1])
      display("right", wrapLon(topRight[0]))
      display("top", topRight[1])
    }

    map.on("moveend", onMoveEnd)
  },
}
</script>
```

:::

## 3.导航控件

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      Map,
      View,
      layer: { Tile: TileLayer },
      source: { OSM },
      control: { ZoomToExtent, defaults: defaultControls },
    } = ol

    const map = new Map({
      controls: defaultControls().extend([
        new ZoomToExtent({
          extent: [
            813079.7791264898, 5929220.284081122, 848966.9639063801,
            5936863.986909639,
          ],
        }),
      ]),
      layers: [
        new TileLayer({
          source: new OSM(),
        }),
      ],
      target: this.$refs.map,
      view: new View({
        center: [0, 0],
        zoom: 2,
      }),
    })
  },
}
</script>
```

:::

## 4.来自哨兵 2 COG 的 NDVI

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
  <div>NDVI: <span id="output"></span></div>
</template>

<script>
export default {
  mounted() {
    let {
      Map,
      layer: { WebGLTile: TileLayer },
      source: { GeoTIFF },
    } = ol

    const source = new GeoTIFF({
      sources: [
        {
          // visible red, band 1 in the style expression above
          url: "https://sentinel-cogs.s3.us-west-2.amazonaws.com/sentinel-s2-l2a-cogs/2020/S2A_36QWD_20200701_0_L2A/B04.tif",
          max: 10000,
        },
        {
          // near infrared, band 2 in the style expression above
          url: "https://sentinel-cogs.s3.us-west-2.amazonaws.com/sentinel-s2-l2a-cogs/2020/S2A_36QWD_20200701_0_L2A/B08.tif",
          max: 10000,
        },
      ],
    })

    const layer = new TileLayer({
      style: {
        color: [
          "interpolate",
          ["linear"],
          // calculate NDVI, bands come from the sources below
          [
            "/",
            ["-", ["band", 2], ["band", 1]],
            ["+", ["band", 2], ["band", 1]],
          ],
          // color ramp for NDVI values, ranging from -1 to 1
          -0.2,
          [191, 191, 191],
          -0.1,
          [219, 219, 219],
          0,
          [255, 255, 224],
          0.025,
          [255, 250, 204],
          0.05,
          [237, 232, 181],
          0.075,
          [222, 217, 156],
          0.1,
          [204, 199, 130],
          0.125,
          [189, 184, 107],
          0.15,
          [176, 194, 97],
          0.175,
          [163, 204, 89],
          0.2,
          [145, 191, 82],
          0.25,
          [128, 179, 71],
          0.3,
          [112, 163, 64],
          0.35,
          [97, 150, 54],
          0.4,
          [79, 138, 46],
          0.45,
          [64, 125, 36],
          0.5,
          [48, 110, 28],
          0.55,
          [33, 97, 18],
          0.6,
          [15, 84, 10],
          0.65,
          [0, 69, 0],
        ],
      },
      source: source,
    })

    const map = new Map({
      target: this.$refs.map,
      layers: [layer],
      view: source.getView(),
    })

    const output = document.getElementById("output")
    function displayPixelValue(event) {
      const data = layer.getData(event.pixel)
      if (!data) {
        return
      }
      const red = data[0]
      const nir = data[1]
      const ndvi = (nir - red) / (nir + red)
      output.textContent = ndvi.toFixed(2)
    }
    map.on(["pointermove", "click"], displayPixelValue)
  },
}
</script>
```

:::

## 5.带有动态彩色坡道的 NDVI

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
  <table>
    <tbody>
      <tr>
        <td>Min NDVI</td>
        <td>
          <input
            type="range"
            id="min-value-input"
            min="-1.0"
            max="-0.1"
            step="0.01"
          />
        </td>
        <td class="data" id="min-value-output"></td>
        <td><input type="color" id="min-color" /></td>
      </tr>
      <tr>
        <td>Max NDVI</td>
        <td>
          <input
            type="range"
            id="max-value-input"
            min="0.1"
            max="1.0"
            step="0.01"
          />
        </td>
        <td class="data" id="max-value-output"></td>
        <td><input type="color" id="max-color" /></td>
      </tr>
    </tbody>
  </table>
</template>

<script>
export default {
  mounted() {
    let {
      Map,
      layer: { WebGLTile: TileLayer },
      source: { GeoTIFF },
    } = ol

    const segments = 10

    const defaultMinColor = "#0300AD"
    const defaultMaxColor = "#00ff00"

    const defaultMinValue = -0.5
    const defaultMaxValue = 0.7

    const minColorInput = document.getElementById("min-color")
    minColorInput.value = defaultMinColor

    const maxColorInput = document.getElementById("max-color")
    maxColorInput.value = defaultMaxColor

    const minValueOutput = document.getElementById("min-value-output")
    const minValueInput = document.getElementById("min-value-input")
    minValueInput.value = defaultMinValue.toString()

    const maxValueOutput = document.getElementById("max-value-output")
    const maxValueInput = document.getElementById("max-value-input")
    maxValueInput.value = defaultMaxValue.toString()

    function getVariables() {
      const variables = {}

      const minColor = minColorInput.value
      const maxColor = maxColorInput.value
      const scale = chroma.scale([minColor, maxColor]).mode("lab")

      const minValue = parseFloat(minValueInput.value)
      const maxValue = parseFloat(maxValueInput.value)
      const delta = (maxValue - minValue) / segments

      for (let i = 0; i <= segments; ++i) {
        const color = scale(i / segments).rgb()
        const value = minValue + i * delta
        variables[`value${i}`] = value
        variables[`red${i}`] = color[0]
        variables[`green${i}`] = color[1]
        variables[`blue${i}`] = color[2]
      }
      return variables
    }

    function colors() {
      const stops = []
      for (let i = 0; i <= segments; ++i) {
        stops[i * 2] = ["var", `value${i}`]
        const red = ["var", `red${i}`]
        const green = ["var", `green${i}`]
        const blue = ["var", `blue${i}`]
        stops[i * 2 + 1] = ["color", red, green, blue]
      }
      return stops
    }

    const ndvi = [
      "/",
      ["-", ["band", 2], ["band", 1]],
      ["+", ["band", 2], ["band", 1]],
    ]

    const source = new GeoTIFF({
      sources: [
        {
          // visible red, band 1 in the style expression above
          url: "https://sentinel-cogs.s3.us-west-2.amazonaws.com/sentinel-s2-l2a-cogs/2020/S2A_36QWD_20200701_0_L2A/B04.tif",
          max: 10000,
        },
        {
          // near infrared, band 2 in the style expression above
          url: "https://sentinel-cogs.s3.us-west-2.amazonaws.com/sentinel-s2-l2a-cogs/2020/S2A_36QWD_20200701_0_L2A/B08.tif",
          max: 10000,
        },
      ],
    })

    const layer = new TileLayer({
      style: {
        variables: getVariables(),
        color: ["interpolate", ["linear"], ndvi, ...colors()],
      },
      source: source,
    })

    function update() {
      layer.updateStyleVariables(getVariables())
      minValueOutput.innerText = parseFloat(minValueInput.value).toFixed(1)
      maxValueOutput.innerText = parseFloat(maxValueInput.value).toFixed(1)
    }

    minColorInput.addEventListener("input", update)
    maxColorInput.addEventListener("input", update)
    minValueInput.addEventListener("input", update)
    maxValueInput.addEventListener("input", update)
    update()

    const map = new Map({
      target: this.$refs.map,
      layers: [layer],
      view: source.getView(),
    })
  },
}
</script>
```

:::
