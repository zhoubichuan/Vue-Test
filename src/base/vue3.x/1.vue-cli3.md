---
lang: zh-CN
sidebarDepth: 2
meta:
  - name: description
    content: 个人总结的openlayers学习技术文档-语法
  - name: keywords
    content: vuepress,最新技术文档,vuepress语法,markdown语法
---

# 一.车辆运行轨迹

## 1

:::demo

```vue
<template>
  <div id="map" class="map"></div>
  <button id="btn">轨迹回放</button>
</template>

<script>
export default {
  mounted() {
    // 获取轨迹点
    fetch(this.$withBase("/data/1.json"))
      .then(function (response) {
        return response.json()
      })
      .then(function (points) {
    // 轨迹
    var route = new ol.geom.LineString(points);
    var routeCoords = route.getCoordinates();
    var routeLength = routeCoords.length;

    // 轨迹线要素
    var routeFeature = new ol.Feature({
      type: "route",
      geometry: route,
    });

    // 轨迹点要素
    var geoMarker = new ol.Feature({
      type: "geoMarker",
      geometry: new ol.geom.Point(routeCoords[0]),
    });

    // 创建样式
    var styles = {
      route: new ol.style.Style({
        stroke: new ol.style.Stroke({
          width: 5,
          color: "blue",
        }),
      }),
      geoMarker: new ol.style.Style({
        image: new ol.style.Circle({
          radius: 10,
          snapToPixel: false,
          fill: new ol.style.Fill({
            color: "red",
          }),
        }),
      }),
    };

    var center = [13451034.958002912, 3594986.8806004445];
    var animating = false;
    var speed, now;

    // 创建瓦片图层
    var tileLayer = new ol.layer.Tile({
      source: new ol.source.OSM(),
    });

    // 创建要素图层
    var vectorLayer = new ol.layer.Vector({
      source: new ol.source.Vector({
        features: [routeFeature, geoMarker],
      }),
      style: function (feature) {
        if (animating && feature.get("type") === "geoMarker") {
          return null;
        }
        return styles[feature.get("type")];
      },
    });

    // 创建地图
    var map = new ol.Map({
      target: "map",
      layers: [
        tileLayer,
        vectorLayer
        ],
      view: new ol.View({
        center: center,
        zoom: 17,
      }),
    });

    // 监听事件
    var moveFeature = function (event) {
      var vectorContext = event.vectorContext;
      var frameState = event.frameState;

      if (animating) {
        var elapsedTime = frameState.time - now;
        var index = Math.round((speed * elapsedTime) / 1000);
        if (index >= routeLength) {
          stopAnimation(true);
          return;
        }

        var currentPoint = new ol.geom.Point(routeCoords[index]);
        var feature = new ol.Feature(currentPoint);
        vectorContext.drawFeature(feature, styles.geoMarker);
      }
      map.render();
    };

    // 开始动画
    function startAnimation() {
      if (animating) {
        stopAnimation(false);
      } else {
        animating = true;
        now = new Date().getTime();
        speed = 50;
        geoMarker.setStyle(null);
        map.getView().setCenter(center);
        map.on("postcompose", moveFeature);
        map.render();
      }
    }

    // 停止动画
    function stopAnimation(ended) {
      animating = false;
      var coord = ended ? routeCoords[routeLength - 1] : routeCoords[0];
      geoMarker.getGeometry().setCoordinates(coord);
      map.un("postcompose", moveFeature);
    }

    // 轨迹回放
    $("#btn").click(function () {
      startAnimation();
    });
        })

  },
};
</script>
```

:::


