---
lang: zh-CN
sidebarDepth: 2
meta:
  - name: description
    content: 个人总结的openlayers学习技术文档-语法
  - name: keywords
    content: vuepress,最新技术文档,vuepress语法,markdown语法
---

# 九.案例 9

## 1.地理坐标为 WFS

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      format: { GeoJSON },
      Map,
      View,
      layer: { Tile: TileLayer, Vector: VectorLayer },
      source: { XYZ, Vector: VectorSource },
      style: { Stroke, Style },
      tilegrid: { createXYZ },
      loadingstrategy: { tile },
      proj: { useGeographic },
    } = ol

    useGeographic()

    const vectorSource = new VectorSource({
      format: new GeoJSON(),
      url: function (extent) {
        return (
          "https://ahocevar.com/geoserver/wfs?service=WFS&" +
          "version=1.1.0&request=GetFeature&typename=osm:water_areas&" +
          "outputFormat=application/json&srsname=EPSG:4326&" +
          "bbox=" +
          extent.join(",") +
          ",EPSG:4326"
        )
      },
      strategy: tile(createXYZ({ tileSize: 512 })),
    })

    const vector = new VectorLayer({
      source: vectorSource,
      style: new Style({
        stroke: new Stroke({
          color: "rgba(0, 0, 255, 1.0)",
          width: 2,
        }),
      }),
    })

    const attributions =
      '<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> ' +
      '<a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>'

    const raster = new TileLayer({
      source: new XYZ({
        attributions: attributions,
        url:
          "https://api.maptiler.com/tiles/satellite/{z}/{x}/{y}.jpg?key=" +
          mapkeys.maptiler,
        maxZoom: 20,
      }),
    })

    const map = new Map({
      layers: [raster, vector],
      target: document.getElementById("map"),
      view: new View({
        center: [-80.0298, 43.4578],
        maxZoom: 19,
        zoom: 12,
      }),
    })
  },
}
</script>
```

:::

## 2.风箭

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      Feature,
      geom: { Point },
      Map,
      View,
      layer: { Tile: TileLayer, Vector: VectorLayer },
      source: { OSM, Vector: VectorSource },
      style: { Fill, RegularShape, Stroke, Style },
      proj: { fromLonLat },
    } = ol

    const shaft = new RegularShape({
      points: 2,
      radius: 5,
      stroke: new Stroke({
        width: 2,
        color: "black",
      }),
      rotateWithView: true,
    })

    const head = new RegularShape({
      points: 3,
      radius: 5,
      fill: new Fill({
        color: "black",
      }),
      rotateWithView: true,
    })

    const styles = [new Style({ image: shaft }), new Style({ image: head })]

    const source = new VectorSource({
      attributions:
        'Weather data by <a href="https://openweathermap.org/current">OpenWeather</a>',
    })

    const map = new Map({
      layers: [
        new TileLayer({
          source: new OSM(),
        }),
        new VectorLayer({
          source: source,
          style: function (feature) {
            const wind = feature.get("wind")
            // rotate arrow away from wind origin
            const angle = ((wind.deg - 180) * Math.PI) / 180
            const scale = wind.speed / 10
            shaft.setScale([1, scale])
            shaft.setRotation(angle)
            head.setDisplacement([
              0,
              head.getRadius() / 2 + shaft.getRadius() * scale,
            ])
            head.setRotation(angle)
            return styles
          },
        }),
      ],
      target: this.$refs.map,
      view: new View({
        center: [12579156, 3274244],
        zoom: 2,
      }),
    })

    fetch(this.$withBase("/data/openweather/weather.json"))
      .then(function (response) {
        return response.json()
      })
      .then(function (data) {
        const features = []
        data.list.forEach(function (report) {
          const feature = new Feature(
            new Point(fromLonLat([report.coord.lon, report.coord.lat]))
          )
          feature.setProperties(report)
          features.push(feature)
        })
        source.addFeatures(features)
        map.getView().fit(source.getExtent())
      })
  },
}
</script>
```

:::

## 3.WKB

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      format: { WKB },
      Map,
      View,
      layer: { Tile: TileLayer, Vector: VectorLayer },
      source: { OSM, Vector: VectorSource },
    } = ol
    const raster = new TileLayer({
      source: new OSM(),
    })

    const wkb =
      "0103000000010000000500000054E3A59BC4602540643BDF4F8D1739C05C8FC2F5284C4140EC51B81E852B34C0D578E926316843406F1283C0CAD141C01B2FDD2406012B40A4703D0AD79343C054E3A59BC4602540643BDF4F8D1739C0"

    const format = new WKB()

    const feature = format.readFeature(wkb, {
      dataProjection: "EPSG:4326",
      featureProjection: "EPSG:3857",
    })

    const vector = new VectorLayer({
      source: new VectorSource({
        features: [feature],
      }),
    })

    const map = new Map({
      layers: [raster, vector],
      target: this.$refs.map,
      view: new View({
        center: [2952104.0199, -3277504.823],
        zoom: 4,
      }),
    })
  },
}
</script>
```

:::

## 4.WKT

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      format: { WKT },
      Map,
      View,
      layer: { Tile: TileLayer, Vector: VectorLayer },
      source: { OSM, Vector: VectorSource },
    } = ol
    const raster = new TileLayer({
      source: new OSM(),
    })

    const wkt =
      "POLYGON((10.689 -25.092, 34.595 " +
      "-20.170, 38.814 -35.639, 13.502 " +
      "-39.155, 10.689 -25.092))"

    const format = new WKT()

    const feature = format.readFeature(wkt, {
      dataProjection: "EPSG:4326",
      featureProjection: "EPSG:3857",
    })

    const vector = new VectorLayer({
      source: new VectorSource({
        features: [feature],
      }),
    })

    const map = new Map({
      layers: [raster, vector],
      target: this.$refs.map,
      view: new View({
        center: [2952104.0199, -3277504.823],
        zoom: 4,
      }),
    })
  },
}
</script>
```

:::

## 5.WMS 512x256 瓦片

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      tilegrid: { TileGrid },
      Map,
      View,
      layer: { Tile: TileLayer },
      source: { TileWMS, OSM },
      extent: { getWidth },
      proj: { get: getProjection },
    } = ol

    const projExtent = getProjection("EPSG:3857").getExtent()
    const startResolution = getWidth(projExtent) / 256
    const resolutions = new Array(22)
    for (let i = 0, ii = resolutions.length; i < ii; ++i) {
      resolutions[i] = startResolution / Math.pow(2, i)
    }
    const tileGrid = new TileGrid({
      extent: [-13884991, 2870341, -7455066, 6338219],
      resolutions: resolutions,
      tileSize: [512, 256],
    })

    const layers = [
      new TileLayer({
        source: new OSM(),
      }),
      new TileLayer({
        source: new TileWMS({
          url: "https://ahocevar.com/geoserver/wms",
          params: { LAYERS: "topp:states", TILED: true },
          serverType: "geoserver",
          tileGrid: tileGrid,
        }),
      }),
    ]
    const map = new Map({
      layers: layers,
      target: this.$refs.map,
      view: new View({
        center: [-10997148, 4569099],
        zoom: 4,
      }),
    })
    Copy
  },
}
</script>
```

:::
