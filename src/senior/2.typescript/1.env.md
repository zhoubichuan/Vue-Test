---
lang: zh-CN
sidebarDepth: 2
meta:
  - name: description
    content: 个人总结的openlayers学习技术文档-语法
  - name: keywords
    content: vuepress,最新技术文档,vuepress语法,markdown语法
---

# 一.案例1

## 1.高 DPI WMTS

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      format: { WMTSCapabilities },
      Map,
      View,
      layer: { Tile: TileLayer },
      source: {
        WMTS: { optionsFromCapabilities },
      },
      has: { DEVICE_PIXEL_RATIO },
    } = ol
    const capabilitiesUrl = "https://basemap.at/wmts/1.0.0/WMTSCapabilities.xml"
    const hiDPI = DEVICE_PIXEL_RATIO > 1
    const layer = hiDPI ? "bmaphidpi" : "geolandbasemap"
    const tilePixelRatio = hiDPI ? 2 : 1

    const map = new Map({
      target: this.$refs.map,
      view: new View({
        center: [1823849, 6143760],
        zoom: 11,
      }),
    })

    fetch(capabilitiesUrl)
      .then(function (response) {
        return response.text()
      })
      .then(function (text) {
        const result = new WMTSCapabilities().read(text)
        const options = optionsFromCapabilities(result, {
          layer: layer,
          matrixSet: "google3857",
          style: "normal",
        })
        options.tilePixelRatio = tilePixelRatio
        options.attributions =
          'Grundkarte: <a target="_blank" href="https://basemap.at/">basemap.at</a>'
        map.addLayer(
          new TileLayer({
            source: new WMTS(options),
          })
        )
      })
  },
}
</script>
```

:::

## 2.命中容忍度

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
  <span id="status">Try to click the line in the map.</span>
  <form class="form-inline">
    <label for="hitTolerance"
      >Hit tolerance for selecting features: &nbsp;</label
    >
    <select id="hitTolerance" class="form-control">
      <option value="0" selected>0 Pixels</option>
      <option value="5">5 Pixels</option>
      <option value="10">10 Pixels</option>
    </select>
    &nbsp; Area: &nbsp;
    <canvas id="circle" style="vertical-align: middle" />
  </form>
</template>

<script>
export default {
  mounted() {
    let {
      Feature,
      geom: { LineString },
      Map,
      View,
      layer: { Tile: TileLayer, Vector: VectorLayer },
      source: { OSM, Vector: VectorSource },
      style: { Stroke, Style },
    } = ol
    const raster = new TileLayer({
      source: new OSM(),
    })

    const style = new Style({
      stroke: new Stroke({
        color: "black",
        width: 1,
      }),
    })

    const feature = new Feature(
      new LineString([[120.8327029,30.7087856],[120.8327029,30.7087856],[120.8327029,30.7087856],[120.8327028,30.7087856],[120.8327029,30.7087856],[120.8327029,30.7087856],[120.8327029,30.7087856],[120.8327029,30.7087856],[120.8327027,30.7087855],[120.8327023,30.7087854],[120.8327024,30.7087853],[120.8327031,30.7087854],[120.8327038,30.7087856],[120.8327039,30.7087858],[120.832704,30.7087859],[120.8327038,30.7087861],[120.8327034,30.7087863],[120.8327028,30.7087851],[120.8327001,30.7087786],[120.8326971,30.7087708],[120.8326911,30.7087545],[120.832686,30.7087412],[120.8326778,30.7087201],[120.8326726,30.708706],[120.8326663,30.7086881],[120.832662,30.7086782],[120.8326549,30.7086659],[120.8326486,30.7086588],[120.832635,30.708648],[120.832623,30.7086399],[120.8326005,30.7086251],[120.832582,30.7086131],[120.8325494,30.7085924],[120.8325243,30.708576],[120.8324841,30.7085486],[120.8324554,30.7085292],[120.8324133,30.7085013],[120.832386,30.7084831],[120.8323481,30.7084582],[120.832326,30.708443],[120.8322986,30.7084237],[120.8322834,30.7084134],[120.832266,30.7084014],[120.8322568,30.7083955],[120.8322442,30.7083898],[120.8322356,30.7083878],[120.8322233,30.7083869],[120.8322143,30.7083878],[120.8321981,30.7083908],[120.8321852,30.7083939],[120.8321616,30.7083994],[120.832142,30.708404],[120.8321054,30.7084121],[120.8320768,30.7084188],[120.832031,30.7084295],[120.831997,30.7084365],[120.831946,30.7084478],[120.8319139,30.7084553],[120.8318712,30.7084652],[120.8318454,30.7084708],[120.8318128,30.7084778],[120.8317952,30.7084818],[120.8317751,30.7084858],[120.8317656,30.7084879],[120.8317565,30.7084901],[120.8317526,30.7084903],[120.83175,30.7084896],[120.8317503,30.7084881],[120.8317517,30.7084844],[120.8317527,30.7084807],[120.8317548,30.7084732],[120.8317571,30.7084661],[120.8317616,30.7084505],[120.8317654,30.708436],[120.8317724,30.7084097],[120.8317781,30.7083885],[120.8317881,30.7083511],[120.8317954,30.7083226],[120.8318072,30.708277],[120.8318159,30.7082441],[120.8318292,30.7081947],[120.8318376,30.7081633],[120.8318492,30.7081203],[120.8318563,30.7080939],[120.8318656,30.7080597],[120.8318706,30.7080405],[120.8318753,30.7080179],[120.8318779,30.7080061],[120.8318813,30.7079923],[120.8318826,30.7079858],[120.8318844,30.7079817],[120.8318863,30.7079823],[120.8318905,30.7079858],[120.8318941,30.7079895],[120.8319012,30.7079974],[120.8319075,30.7080039],[120.8319183,30.708015],[120.8319269,30.7080241],[120.8319415,30.7080394],[120.8319526,30.7080513],[120.8319706,30.7080718],[120.8319841,30.7080868],[120.8320072,30.7081099],[120.8320244,30.7081255],[120.8320514,30.7081494],[120.8320707,30.7081663],[120.8321018,30.7081928],[120.8321246,30.708212],[120.8321606,30.7082426],[120.8321864,30.7082647],[120.832227,30.7082993],[120.8322549,30.7083232],[120.8322982,30.7083603],[120.8323272,30.7083855],[120.832369,30.7084203],[120.8323964,30.7084425],[120.8324344,30.7084745],[120.832458,30.7084947],[120.8324912,30.7085227],[120.8325121,30.7085402],[120.8325402,30.7085634],[120.8325579,30.7085779],[120.832582,30.7085989],[120.8325967,30.7086115],[120.8326161,30.7086273],[120.8326272,30.7086372],[120.8326418,30.7086511],[120.8326501,30.7086599],[120.8326594,30.7086741],[120.8326647,30.7086847],[120.832672,30.7087017],[120.8326766,30.7087136],[120.8326829,30.7087316],[120.832687,30.7087434],[120.8326921,30.7087587],[120.8326952,30.7087668],[120.8326987,30.7087758],[120.8327003,30.70878],[120.832702,30.7087839],[120.8327027,30.7087853],[120.8327028,30.7087858],[120.8327028,30.7087854],[120.8327029,30.7087852],[120.832703,30.708785],[120.8327027,30.7087848],[120.8327024,30.7087847],[120.832702,30.7087847],[120.8327018,30.708785],[120.8327014,30.7087852],[120.8327017,30.7087851],[120.8327023,30.7087851],[120.8327021,30.7087853],[120.8327019,30.7087854],[120.8327021,30.7087854],[120.8327024,30.7087853],[120.8327025,30.7087854],[120.8327026,30.7087855],[120.8327027,30.7087854],[120.8327028,30.7087854],[120.8327029,30.7087855],[120.8327029,30.7087853],[120.8327028,30.7087852],[120.8327027,30.7087854],[120.8327027,30.7087855],[120.8327026,30.7087858],[120.8327026,30.708786],[120.8327026,30.708786],[120.8327026,30.708786],[120.8327026,30.708786],[120.8327026,30.708786],[120.8327026,30.708786],[120.8327026,30.708786],[120.8327026,30.708786],[120.8327026,30.708786],[120.8327026,30.708786],[120.8327026,30.708786],[120.8327026,30.708786],[120.8327026,30.708786],[120.8327026,30.708786],[120.8327026,30.708786],[120.8327026,30.708786],[120.8327026,30.708786],[120.8327026,30.7087859],[120.8327026,30.7087859],[120.8327026,30.708786],[120.8327026,30.708786],[120.8327026,30.7087859],[120.8327026,30.708786],[120.8327026,30.708786],[120.8327026,30.708786],[120.8327026,30.708786],[120.8327026,30.708786],[120.8327026,30.708786],[120.8327026,30.708786],[120.8327026,30.708786],[120.8327026,30.708786],[120.8327026,30.708786],[120.8327026,30.708786],[120.8327026,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.7087861],[120.8327027,30.7087862],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.708786],[120.8327027,30.7087861],[120.8327027,30.7087862],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.708786],[120.8327027,30.7087859],[120.8327027,30.7087859],[120.8327027,30.7087859],[120.8327026,30.708786],[120.8327026,30.7087861],[120.8327026,30.7087861],[120.8327027,30.7087861],[120.8327028,30.708786],[120.8327027,30.7087861],[120.8327026,30.7087859],[120.8327028,30.7087861],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.708786],[120.8327027,30.7087859],[120.8327026,30.708786],[120.8327026,30.708786],[120.8327026,30.708786],[120.8327026,30.708786],[120.8327027,30.708786],[120.8327026,30.708786],[120.8327027,30.7087861],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.7087861],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.7087861],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.7087861],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327026,30.7087859],[120.8327026,30.708786],[120.8327027,30.7087861],[120.8327028,30.7087861],[120.8327028,30.7087861],[120.8327028,30.7087861],[120.8327027,30.7087862],[120.8327027,30.7087863],[120.8327026,30.7087862],[120.8327026,30.7087862],[120.8327027,30.7087861],[120.8327028,30.7087859],[120.8327028,30.708786],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327028,30.7087861],[120.8327028,30.7087861],[120.8327029,30.7087862],[120.8327029,30.7087863],[120.8327028,30.7087863],[120.8327028,30.7087862],[120.8327028,30.7087861],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.708786],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327025,30.7087859],[120.8327025,30.7087858],[120.8327027,30.708786],[120.8327028,30.7087861],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327028,30.708786],[120.8327028,30.708786],[120.8327027,30.708786],[120.8327026,30.708786],[120.8327027,30.708786],[120.8327027,30.708786],[120.8327027,30.7087861],[120.8327027,30.7087861],[120.8327027,30.7087861]])
    )

    const vector = new VectorLayer({
      source: new VectorSource({
        features: [feature],
      }),
      style: style,
    })

    const map = new Map({
      layers: [raster, vector],
      target: this.$refs.map,
      view: new View({
        center:[12579156, 3274244],
        zoom: 2,
      }),
    })

    let hitTolerance

    const statusElement = document.getElementById("status")

    map.on("singleclick", function (e) {
      let hit = false
      map.forEachFeatureAtPixel(
        e.pixel,
        function () {
          hit = true
        },
        {
          hitTolerance: hitTolerance,
        }
      )
      if (hit) {
        style.getStroke().setColor("green")
        statusElement.innerHTML = "A feature got hit!"
      } else {
        style.getStroke().setColor("black")
        statusElement.innerHTML = "No feature got hit."
      }
      feature.changed()
    })

    const selectHitToleranceElement = document.getElementById("hitTolerance")
    const circleCanvas = document.getElementById("circle")

    const changeHitTolerance = function () {
      hitTolerance = parseInt(selectHitToleranceElement.value, 10)

      const size = 2 * hitTolerance + 2
      circleCanvas.width = size
      circleCanvas.height = size
      const ctx = circleCanvas.getContext("2d")
      ctx.clearRect(0, 0, size, size)
      ctx.beginPath()
      ctx.arc(
        hitTolerance + 1,
        hitTolerance + 1,
        hitTolerance + 0.5,
        0,
        2 * Math.PI
      )
      ctx.fill()
      ctx.stroke()
    }

    selectHitToleranceElement.onchange = changeHitTolerance
    changeHitTolerance()
  },
}
</script>
```

:::

## 3.图标颜色

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      Feature,
      geom: { Point },
      Map,
      View,
      layer: { Tile: TileLayer, Vector: VectorLayer },
      source: { TileJSON, Vector: VectorSource },
      style: { Icon, Style },
      proj: { fromLonLat },
    } = ol
    const rome = new Feature({
      geometry: new Point(fromLonLat([12.5, 41.9])),
    })

    const london = new Feature({
      geometry: new Point(fromLonLat([-0.12755, 51.507222])),
    })

    const madrid = new Feature({
      geometry: new Point(fromLonLat([-3.683333, 40.4])),
    })
    const paris = new Feature({
      geometry: new Point(fromLonLat([2.353, 48.8566])),
    })
    const berlin = new Feature({
      geometry: new Point(fromLonLat([13.3884, 52.5169])),
    })

    rome.setStyle(
      new Style({
        image: new Icon({
          color: "#BADA55",
          crossOrigin: "anonymous",
          // For Internet Explorer 11
          imgSize: [20, 20],
          src: "data/square.svg",
        }),
      })
    )

    london.setStyle(
      new Style({
        image: new Icon({
          color: "rgba(255, 0, 0, .5)",
          crossOrigin: "anonymous",
          src: "data/bigdot.png",
          scale: 0.2,
        }),
      })
    )

    madrid.setStyle(
      new Style({
        image: new Icon({
          crossOrigin: "anonymous",
          src: "data/bigdot.png",
          scale: 0.2,
        }),
      })
    )

    paris.setStyle(
      new Style({
        image: new Icon({
          color: "#8959A8",
          crossOrigin: "anonymous",
          // For Internet Explorer 11
          imgSize: [20, 20],
          src: "data/dot.svg",
        }),
      })
    )

    berlin.setStyle(
      new Style({
        image: new Icon({
          crossOrigin: "anonymous",
          // For Internet Explorer 11
          imgSize: [20, 20],
          src: "data/dot.svg",
        }),
      })
    )
    const vectorSource = new VectorSource({
      features: [rome, london, madrid, paris, berlin],
    })

    const vectorLayer = new VectorLayer({
      source: vectorSource,
    })

    const rasterLayer = new TileLayer({
      source: new TileJSON({
        url: "https://a.tiles.mapbox.com/v3/aj.1x1-degrees.json?secure=1",
        crossOrigin: "",
      }),
    })

    const map = new Map({
      layers: [rasterLayer, vectorLayer],
      target: this.$refs.map,
      view: new View({
        center: fromLonLat([2.896372, 44.6024]),
        zoom: 3,
      }),
    })
  },
}
</script>
```

:::

## 4.图标修改

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      Feature,
      geom: { Point },
      Map,
      View,
      layer: { Tile: TileLayer, Vector: VectorLayer },
      source: { TileJSON, Vector: VectorSource },
      style: { Icon, Style },
      interaction: { Modify },
    } = ol

    const iconFeature = new Feature({
      geometry: new Point([0, 0]),
      name: "Null Island",
      population: 4000,
      rainfall: 500,
    })

    const iconStyle = new Style({
      image: new Icon({
        anchor: [0.5, 46],
        anchorXUnits: "fraction",
        anchorYUnits: "pixels",
        src: this.$withBase("/data/icon.png"),
      }),
    })

    iconFeature.setStyle(iconStyle)

    const vectorSource = new VectorSource({
      features: [iconFeature],
    })

    const vectorLayer = new VectorLayer({
      source: vectorSource,
    })

    const rasterLayer = new TileLayer({
      source: new TileJSON({
        url: "https://a.tiles.mapbox.com/v3/aj.1x1-degrees.json?secure=1",
        crossOrigin: "",
      }),
    })

    const target = this.$refs.map
    const map = new Map({
      layers: [rasterLayer, vectorLayer],
      target: target,
      view: new View({
        center:[12579156, 3274244],
        zoom: 3,
      }),
    })

    const modify = new Modify({
      hitDetection: vectorLayer,
      source: vectorSource,
    })
    modify.on(["modifystart", "modifyend"], function (evt) {
      target.style.cursor = evt.type === "modifystart" ? "grabbing" : "pointer"
    })
    const overlaySource = modify.getOverlay().getSource()
    overlaySource.on(["addfeature", "removefeature"], function (evt) {
      target.style.cursor = evt.type === "addfeature" ? "pointer" : ""
    })

    map.addInteraction(modify)
  },
}
</script>
```

:::

## 5.图标像素操作

:::demo

```vue
<template>
  <div id="map" class="map">
    <div id="popup"></div>
  </div>
</template>

<script>
export default {
  mounted() {
    let {
      Feature,
      Overlay,
      geom: { Point },
      Map,
      View,
      layer: { Tile: TileLayer, Vector: VectorLayer },
      source: { TileJSON, Vector: VectorSource },
      style: { Icon, Style, Text },
      proj: { fromLonLat },
      render: { getVectorContext },
    } = ol

    const rasterLayer = new TileLayer({
      source: new TileJSON({
        url: "https://a.tiles.mapbox.com/v3/aj.1x1-degrees.json?secure=1",
        crossOrigin: "",
      }),
    })

    const iconFeature = new Feature({
      geometry: new Point(fromLonLat([0, -10])),
      name: "Fish.1",
    })

    const feature1 = new Feature({
      geometry: new Point(fromLonLat([0, -10])),
      name: "Fish.1 Island",
    })

    const feature2 = new Feature({
      geometry: new Point(fromLonLat([-30, 10])),
      name: "Fish.2 Island",
    })

    const iconStyle = new Style({
      image: new Icon({
        anchor: [0.5, 0.9],
        src: "data/fish.png",
        crossOrigin: "",
        scale: [0, 0],
        rotation: Math.PI / 4,
      }),
      text: new Text({
        text: "FISH\nTEXT",
        scale: [0, 0],
        rotation: Math.PI / 4,
        textAlign: "center",
        textBaseline: "top",
      }),
    })

    let i = 0
    let j = 45

    iconFeature.setStyle(function () {
      const x = Math.sin((i * Math.PI) / 180) * 3
      const y = Math.sin((j * Math.PI) / 180) * 4
      iconStyle.getImage().setScale([x, y])
      iconStyle.getText().setScale([x, y])
      return iconStyle
    })

    rasterLayer.on("postrender", function (event) {
      const vectorContext = getVectorContext(event)
      const x = Math.cos((i * Math.PI) / 180) * 3
      const y = Math.cos((j * Math.PI) / 180) * 4
      iconStyle.getImage().setScale([x, y])
      iconStyle.getText().setScale([x, y])
      vectorContext.drawFeature(feature2, iconStyle)
    })

    const vectorSource = new VectorSource({
      features: [iconFeature, feature1, feature2],
    })

    const vectorLayer = new VectorLayer({
      source: vectorSource,
    })

    const map = new Map({
      layers: [rasterLayer, vectorLayer],
      target: this.$refs.map,
      view: new View({
        center: fromLonLat([-15, 0]),
        zoom: 3,
      }),
    })

    setInterval(function () {
      i = (i + 4) % 360
      j = (j + 5) % 360
      vectorSource.changed()
    }, 1000)

    const element = document.getElementById("popup")

    const popup = new Overlay({
      element: element,
      positioning: "bottom-center",
      stopEvent: false,
    })
    map.addOverlay(popup)

    // display popup on click
    map.on("click", function (evt) {
      const feature = map.forEachFeatureAtPixel(evt.pixel, function (feature) {
        return feature
      })
      $(element).popover("dispose")
      if (feature) {
        popup.setPosition(evt.coordinate)
        $(element).popover({
          placement: "top",
          html: true,
          animation: false,
          content: feature.get("name"),
        })
        $(element).popover("show")
      }
    })

    // change mouse cursor when over marker
    map.on("pointermove", function (e) {
      const pixel = map.getEventPixel(e.originalEvent)
      const hit = map.hasFeatureAtPixel(pixel)
      map.getTarget().style.cursor = hit ? "pointer" : ""
    })
    // Close the popup when the map is moved
    map.on("movestart", function () {
      $(element).popover("dispose")
    })
  },
}
</script>
```

:::
