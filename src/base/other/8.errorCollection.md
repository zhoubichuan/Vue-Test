---
lang: zh-CN
sidebarDepth: 2
meta:
  - name: description
    content: 个人总结的openlayers学习技术文档-主题
  - name: keywords
    content: vuepress,最新技术文档,vuepress主题
---

# 八.format
## 2.1 WMTSCapabilities

WMTS 源有一个 tilePixelRatio 选项。支持 HiDPI 的 WMTS 可以提供具有 512x512 像素图块的图块，但在 256x256 像素图块网格中使用它们。在这种情况下 tilePixelRatio 需要设置为 2
:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  async mounted() {
    let {
      format: { WMTSCapabilities },
      Map,
      View,
      layer: { Tile: TileLayer },
      source: { WMTS },
      has: { DEVICE_PIXEL_RATIO },
    } = ol
    const capabilitiesUrl = "https://basemap.at/wmts/1.0.0/WMTSCapabilities.xml"
    const hiDPI = DEVICE_PIXEL_RATIO > 1
    const layer = hiDPI ? "bmaphidpi" : "geolandbasemap"
    const tilePixelRatio = hiDPI ? 2 : 1

    const map = new Map({
      target: this.$refs.map,
      view: new View({
        center: [1823849, 6143760],
        zoom: 11,
      }),
    })
    let res = await axios.get(capabilitiesUrl)
    const result = new WMTSCapabilities().read(res.data)
    const options = WMTS.optionsFromCapabilities(result, {
      layer: layer,
      matrixSet: "google3857",
      style: "normal",
    })
    options.tilePixelRatio = tilePixelRatio
    options.attributions =
      'Grundkarte: <a target="_blank" href="https://basemap.at/">basemap.at</a>'
    map.addLayer(
      new TileLayer({
        source: new WMTS(options),
      })
    )
  },
}
</script>
```

:::

## 2.2 IIIFInfo

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
  <div class="controls">
    <div id="iiif-notification">&nbsp;</div>
    <label for="imageInfoUrl">Enter <code>info.json</code> URL:</label>
    <input
      type="text"
      id="imageInfoUrl"
      value="https://iiif.ub.uni-leipzig.de/iiif/j2k/0000/0107/0000010732/00000072.jpx/info.json"
    />
    <button id="display">Display image</button>
  </div>
</template>

<script>
export default {
  mounted() {
    let {
      format: { IIIFInfo },
      Map,
      View,
      layer: { Tile: TileLayer },
      source: { IIIF },
    } = ol

    const layer = new TileLayer(),
      map = new Map({
        layers: [layer],
        target: this.$refs.map,
      }),
      notifyDiv = document.getElementById("iiif-notification"),
      urlInput = document.getElementById("imageInfoUrl"),
      displayButton = document.getElementById("display")

    function refreshMap(imageInfoUrl) {
      fetch(imageInfoUrl)
        .then(function (response) {
          response
            .json()
            .then(function (imageInfo) {
              const options = new IIIFInfo(imageInfo).getTileSourceOptions()
              if (options === undefined || options.version === undefined) {
                notifyDiv.textContent =
                  "Data seems to be no valid IIIF image information."
                return
              }
              options.zDirection = -1
              const iiifTileSource = new IIIF(options)
              layer.setSource(iiifTileSource)
              map.setView(
                new View({
                  resolutions: iiifTileSource.getTileGrid().getResolutions(),
                  extent: iiifTileSource.getTileGrid().getExtent(),
                  constrainOnlyCenter: true,
                })
              )
              map.getView().fit(iiifTileSource.getTileGrid().getExtent())
              notifyDiv.textContent = ""
            })
            .catch(function (body) {
              notifyDiv.textContent = "Could not read image info json. " + body
            })
        })
        .catch(function () {
          notifyDiv.textContent = "Could not read data from URL."
        })
    }

    displayButton.addEventListener("click", function () {
      refreshMap(urlInput.value)
    })

    refreshMap(urlInput.value)
  },
}
</script>
```

:::

## 2.3 WMSGetFeatureInfo

:::demo

```vue
<template>
  <table ref="info">
    <tr>
      <td>All features:</td>
      <td ref="all"></td>
    </tr>
    <tr>
      <td>Hotel features:</td>
      <td ref="hotel"></td>
    </tr>
    <tr>
      <td>Restaurant features:</td>
      <td ref="restaurant"></td>
    </tr>
  </table>
</template>

<script>
export default {
  async mounted() {
    let {
      format: { WMSGetFeatureInfo },
    } = ol
    let res = await axios.get(
      this.$withBase("/data/wmsgetfeatureinfo/osm-restaurant-hotel.xml")
    )
    const allFeatures = new WMSGetFeatureInfo().readFeatures(res.data)
    this.$refs.all.innerText = allFeatures.length.toString()
    const hotelFeatures = new WMSGetFeatureInfo({
      layers: ["hotel"],
    }).readFeatures(res.data)
    this.$refs.hotel.innerText = hotelFeatures.length.toString()
    const restaurantFeatures = new WMSGetFeatureInfo({
      layers: ["restaurant"],
    }).readFeatures(res.data)
    this.$refs.restaurant.innerText = restaurantFeatures.length.toString()
  },
}
</script>
```

:::

## 2.4 TopoJSON

:::demo

```vue
<template>
  <div ref="map" class="map"></div>
</template>

<script>
export default {
  mounted() {
    let {
      format: { TopoJSON },
      Map,
      View,
      layer: { Tile: TileLayer, Vector: VectorLayer },
      source: { XYZ, Vector: VectorSource },
      style: { Fill, Stroke, Style },
    } = ol
    const attributions =
      '<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> ' +
      '<a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>'
    const raster = new TileLayer({
      source: new XYZ({
        attributions: attributions,
        url:
          "https://api.maptiler.com/maps/darkmatter/{z}/{x}/{y}.png?key=" +
          mapkeys.maptiler,
        tileSize: 512,
      }),
    })
    const style = new Style({
      fill: new Fill({
        color: "rgba(255, 255, 255, 0.6)",
      }),
      stroke: new Stroke({
        color: "#319FD3",
        width: 1,
      }),
    })
    const vector = new VectorLayer({
      source: new VectorSource({
        url: this.$withBase("/data/topojson/world-110m.json"),
        format: new TopoJSON({
          layers: ["countries"],
        }),
        overlaps: false,
      }),
      style: style,
    })
    const map = new Map({
      layers: [raster, vector],
      target: this.$refs.map,
      view: new View({
        center: [12579156, 3274244],
        zoom: 1,
      }),
    })
  },
}
</script>
```

:::

## 3.feature转数据
- 矢量图形的feature --> WKT
- 矢量图形的feature --> GeoJSON
```js
//WKT
var wktshape = new ol.format.WKT().writeFeature(feature);
//GeoJSON
var jsonshape = new ol.format.GeoJSON().writeFeature(feature);
//字符串
var stringPoint = feature.getGeometry().getCoordinates().toString()
```
